{"theme":null,"data":[],"type":{"location":"server","name":"chart"},"owner":"o3tgs6","key":"1b0a69x","permission":{"switch":["public"],"value":[{"switch":"public","perm":"fork"}]},"name":"Pictochart","desc":"represent percentage with multiple small pictogram","tags":[""],"doc":{"name":"document","type":"html","content":"","lines":1,"size":0},"style":{"name":"stylesheet","type":"css","content":"","lines":1,"size":0},"code":{"name":"code","type":"javascript","content":"var module = {};\nmodule.exports = plotdb.chart.create({\n  sample: d3.range(16).map(function(it) {\n    return {\n      name: [\"John\",\"Amelie\",\"Joseph\",\"JoJo\",\"Jacob\"][parseInt(5 * Math.random())],\n      value: d3.range(10).map(function(it) { \n        if(Math.random()<0.5) return 0;\n        return Math.random();\n      })\n    };\n  }),\n  dimension: {\n    value: { type: [plotdb.Number], require: true, multiple: true, desc: \"value\" },\n    name: { type: [], require: false, desc: \"name\" }\n  },\n  config: {\n    padding: { name: \"Padding\", type: [plotdb.Number], default: 10 },\n    margin: { name: \"Margin\", type: [plotdb.Number], default: 10 },\n    maxSize: { name: \"Max Size\", type: [plotdb.Number], default: 200 },\n    fontSize: { name: \"Font Size\", type: [plotdb.Number], default: 12 },\n    palette: { name: \"Palette\", type: [plotdb.Palette], default: plotdb.Palette['default'],\n      hint: plotdb.Palette.subtype.qualitative\n    }\n  },\n  init: function() {\n    var that = this;\n    this.svg = d3.select(this.root).append(\"svg\");\n    this.defs = this.svg.append(\"defs\");\n    this.invert = this.defs.append(\"filter\").attr({\n      id: \"invert\"\n    }).append(\"feColorMatrix\").attr({\n      in: \"SourceGraphic\",\n      type: \"matrix\",\n      values: \"-1 0 0 0 1  0 -1 0 0 1  0 0 -1 0 1  0 0 0 1 0\"\n    });\n    mask = this.defs.append(\"mask\").attr({\n      id: \"mask\",\n      maskUnits: \"objectBoundingBox\",\n      maskContentUnits: \"objectBoundingBox\"\n    })\n    mask.append(\"image\").attr({\n      \"xlink:href\": this.assets[\"man.svg\"].datauri,\n      x: 0, y: 0, width: 1, height: 1,\n      filter: \"url(#invert)\"\n    });\n    this.parsed = this.data.map(function(it) {\n      var ret = {\n        name: it.name,\n        value: it.value.map(function(jt,i) { return {\n          offset: 0, size: jt, group: (\n            that.dimension && that.dimension.value && that.dimension.value.fieldName?\n              that.dimension.value.fieldName[i]:\n              i)\n        }; })\n      };\n      var sum = ret.value.reduce(function(a,b) { return a + b.size; }, 0);\n      var lastOffset = 0;\n      for(var i = 0; i<ret.value.length; i++) {\n        ret.value[i].offset = lastOffset;\n        ret.value[i].size = ret.value[i].size / sum;\n        lastOffset += ret.value[i].size;\n      }\n      return ret;\n    });\n  },\n  bind: function() {\n    var that = this;\n    this.svg.selectAll(\"g.datagroup\").data(this.parsed)\n      .enter().append(\"g\").attr({class: \"datagroup\"}).each(function(it) {\n        var node = d3.select(this);\n        var g = node.append(\"g\").attr({class: \"rects\"});\n        g.selectAll(\"rect.data\").data(it.value)\n          .enter().append(\"rect\").attr({class: \"data\"});\n        node.append(\"text\")\n          .attr({class: \"label\"}).text(function(it) { return it.name; });\n      });\n    \n  },\n  resize: function() {\n    var that = this;\n    var box = this.root.getBoundingClientRect();\n    var width = this.width = box.width;\n    var height = this.height = box.height - 10;\n    var m = this.config.margin;\n    this.size = ((width - 2 * m) / 4 > this.config.maxSize ? this.config.maxSize : (width - 2 * m)/ 4);\n    this.innerSize = this.size - this.config.padding;\n    height += this.size * parseInt(this.data.length / parseInt( (width - 2 * m) / this.size ) -1 );\n    this.svg.attr({\n      width: width + \"px\", height: height + \"px\",\n      viewBox: [0,0,width,height].join(\" \"),\n      preserveAspectRatio: \"xMidYMid\"\n    });\n    this.cscale = d3.scale.ordinal().range(this.config.palette.colors.map(function(it) { return it.hex; }));\n  },\n  render: function() {\n    var that = this;\n    var m = this.config.margin;\n    this.svg.selectAll(\"g.datagroup\").attr({\n      transform: function(it,i) {\n        var x = (i % (parseInt( (that.width - 2 * m) / that.size ))) * that.size + m;\n        var y = parseInt(i / (parseInt( (that.width - 2 * m)/ that.size ))) * that.size + m;\n        return [\"translate(\",x,\",\",y,\")\"].join(\"\");\n      }\n    });\n    this.svg.selectAll(\"g.datagroup g.rects\").attr({\n      mask: \"url(#mask)\"\n    });\n    this.svg.selectAll(\"rect.data\").attr({\n      x: 0,\n      y: function(it) { return (that.innerSize - that.config.fontSize * 5) * it.offset; },\n      width: this.innerSize - that.config.fontSize * 2.5,\n      height: function(it) { \n        return (that.innerSize - that.config.fontSize * 5) * it.size; \n      },\n      fill: function(it) {\n        return that.cscale(it.group);\n      }\n    });\n    this.svg.selectAll(\"text.label\").attr({\n      x: this.innerSize / 2 - that.config.fontSize * 1.25,\n      y: this.innerSize - this.config.fontSize * 3.5,\n      \"text-anchor\": \"middle\",\n      \"dominant-baseline\": \"central\"\n    });\n  }\n});","lines":126,"size":4649},"config":{"padding":{"name":"Padding","type":[{"name":"Number","level":3}],"default":10,"value":10},"margin":{"name":"Margin","type":[{"name":"Number","level":3}],"default":10,"value":"20"},"maxSize":{"name":"Max Size","type":[{"name":"Number","level":3}],"default":200,"value":"150"},"fontSize":{"name":"Font Size","type":[{"name":"Number","level":3}],"default":12,"value":10},"palette":{"name":"Palette","type":[{"name":"Palette","level":5,"re":{},"default":{"colors":[{"hex":"#1d3263"},{"hex":"#226c87"},{"hex":"#f8d672"},{"hex":"#e48e11"},{"hex":"#e03215"},{"hex":"#ab2321"}]},"plotdb":{"colors":[{"hex":"#ed1d78"},{"hex":"#c59b6d"},{"hex":"#8cc63f"},{"hex":"#28aae2"}]},"qualitative":{"colors":[{"hex":"#c05ae0"},{"hex":"#cf2d0c"},{"hex":"#e9ab1e"},{"hex":"#86ffb5"},{"hex":"#64dfff"},{"hex":"#003f7d"}]},"binary":{"colors":[{"hex":"#ff8356"},{"hex":"#0076a1"}]},"sequential":{"colors":[{"hex":"#950431"},{"hex":"#be043e"},{"hex":"#ec326d"},{"hex":"#fc82a9"},{"hex":"#febed2"},{"hex":"#fee6ee"}]},"diverging":{"colors":[{"hex":"#74001a"},{"hex":"#cd2149"},{"hex":"#f23971"},{"hex":"#ff84ab"},{"hex":"#ffc3d7"},{"hex":"#f2f2dd"},{"hex":"#b8d9ed"},{"hex":"#81b1d0"},{"hex":"#3d8bb7"},{"hex":"#0071a8"},{"hex":"#003558"}]},"subtype":{"qualitative":"qualitative","binary":"binary","sequential":"sequential","diverging":"diverging"}}],"default":{"colors":[{"hex":"#1d3263"},{"hex":"#226c87"},{"hex":"#f8d672"},{"hex":"#e48e11"},{"hex":"#e03215"},{"hex":"#ab2321"}]},"hint":"qualitative","value":{"colors":[{"hex":"#1d3263"},{"hex":"#226c87"},{"hex":"#f8d672"},{"hex":"#e48e11"},{"hex":"#e03215"},{"hex":"#ab2321"}]}}},"dimension":{"value":{"type":[{"name":"Number","level":3}],"require":true,"multiple":true,"desc":"value"},"name":{"type":[],"require":false,"desc":"name"}},"assets":[{"name":"man.svg","type":"image/svg+xml","content":"PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMC8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9UUi8yMDAxL1JFQy1TVkctMjAwMTA5MDQvRFREL3N2ZzEwLmR0ZCI+PHN2ZyB2ZXJzaW9uPSIxLjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMzcuMjA3IDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMzcuMjA3IDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PGNpcmNsZSBjeD0iMTguMTE4IiBjeT0iOC4xNTkiIHI9IjguMTU5Ij48L2NpcmNsZT48cGF0aCBkPSJNOC40NzIsOTUuNDI2YzAsMi41MjQsMi4wNSw0LjU3NCw0LjU3NCw0LjU3NGMyLjUyOSwwLDQuNTc2LTIuMDUsNC41NzYtNC41NzRsMC4wMDQtMzguMzc0aDIuMDM3TDE5LjY1LDk1LjQyNg0KCWMwLDIuNTI0LDIuMDQ4LDQuNTc0LDQuNTc0LDQuNTc0czQuNTczLTIuMDUsNC41NzMtNC41NzRsMC4wMi02Ni4xNThoMi4wMDZ2MjQuMzhjMCw0LjkwNSw2LjM5OCw0LjkwNSw2LjM4NCwwdi0yNC45DQoJYzAtNS40MTgtMy4xODQtMTAuNzI4LTkuNTIzLTEwLjcyOEw5LjM5NiwxOC4wMTJDMy42MTksMTguMDEyLDAsMjIuNzIyLDAsMjguNTk5djI1LjA1YzAsNC44NjksNi40MzMsNC44NjksNi40MzMsMHYtMjQuMzhoMi4wNDgNCglMOC40NzIsOTUuNDI2eiI+PC9wYXRoPjwvc3ZnPg=="}],"isType":false,"createdTime":1457449802433,"modifiedTime":1458278733259,"ownerName":"Kirby Wu","likes":0,"parent":null,"basetype":"17","visualencoding":["3"],"category":["1"]}