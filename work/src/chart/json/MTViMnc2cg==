{"0":"1","1":"5","2":"b","3":"2","4":"w","5":"6","6":"r","theme":"1fater3","data":[],"name":"Pie Chart","desc":"this is a standard pie chart.","tags":[""],"owner":"o3tgs6","key":"15b2w6r","type":{"name":"chart","location":"server"},"doc":{"name":"document","type":"html","content":"<h2>Pie Chart</h2>","lines":1,"size":18},"style":{"name":"stylesheet","type":"css","content":"svg {\n  display: block\n}","lines":3,"size":24},"code":{"name":"code","type":"javascript","content":"// Generated by LiveScript 1.3.1\nvar module = {};\nmodule.exports = plotdb.chart.create({\n  name: 'pie',\n  title: \"Pie Chart\",\n  desc: \"A simple responsive pie chart\",\n  author: \"Kirby Wu\",\n  sample: [\n    { value: 1, text: 1, name: \"IE\" }, \n    { value: 7, text: 7, name: \"Chrome\"},\n    { value: 5, text: 5, name: \"Firefox\"},\n    { value: 2, text: 2, name: \"Opera\"},\n    { value: 4, text: 4, name: \"Android\"},\n    { value: 2, text: 2, name: \"Safari\" },\n    { value: 1, text: 1, name: \"Puffin\" }\n  ],\n  dimension: {\n    value: { type: [plotdb.Number], require: true },\n    name: { type: [], require: false },\n    text: { type: [], require: false }\n  },\n  config: {\n    padding: { type: [plotdb.Number, plotdb.Percent], 'default': 10 },\n    margin: { type: [plotdb.Number, plotdb.Percent], 'default': 10 },\n    radius: { type: [plotdb.Number], 'default': 5 },\n    palette: {\n      type: [plotdb.Palette], 'default': plotdb.Palette['default'],\n      hint: plotdb.Palette.subtype.qualitative\n    },\n    fontSize: { type: [plotdb.Number], 'default': 12 },\n    showLabel: { type: [plotdb.Boolean], 'default': true },\n    labelOutside: { type: [plotdb.Boolean], 'default': true },\n    ringMode: { type: [plotdb.Boolean], 'default': false }\n  },\n  init: function(){\n    this.svg = d3.select(this.root).append('svg');\n    this.g = this.svg.append('g');\n    return this.gLegend = this.svg.append('g');\n  },\n  bind: function(){\n    var sum, x$, y$, z$, z1$;\n    var root = this.root, config = this.config, data = this.data;\n    this.pie = d3.layout.pie().value(function(it){\n      return it.value;\n    }).padAngle(0.00);\n    sum = data.map(function(it){\n      return parseFloat(it.value);\n    }).reduce(function(a, b){\n      return a + b;\n    }, 0);\n    data.map(function(it){\n      return it.percent = parseInt(1000 * it.value / sum) / 10 + \"%\";\n    });\n    this.data = this.pie(data);\n    x$ = this.g.selectAll('path.wedge').data(this.data);\n    x$.enter().append('path').attr({\n      'class': 'wedge'\n    });\n    x$.exit().remove();\n    y$ = this.g.selectAll('text.value').data(this.data);\n    y$.enter().append('text').attr({\n      'class': 'value'\n    });\n    z$ = this.gLegend.selectAll('rect.legend').data(this.data);\n    z$.enter().append('rect').attr({\n      'class': 'legend'\n    });\n    z1$ = this.gLegend.selectAll('text.legend').data(this.data);\n    z1$.enter().append('text').attr({\n      'class': 'legend'\n    });\n    return z1$;\n  },\n  resize: function(){\n    var ref$, w, h, m, p, f, this$ = this;\n    var root = this.root, config = this.config, data = this.data;\n    ref$ = [$(root).width(), $(root).height()], w = ref$[0], h = ref$[1];\n    ref$ = [config.margin, config.padding, config.fontSize], m = ref$[0], p = ref$[1], f = ref$[2];\n    var svgbox = $(root).find(\"svg\")[0].getBoundingClientRect();\n    this.w = w;\n    this.h = h - svgbox.top;\n    this.m = m;\n    this.legendWidth = f * d3.max(this.data.map(function(it){\n      return (it.name || \"\").length;\n    }).concat([1])) + 10;\n    w = w - this.legendWidth - this.m;\n    this.mw = w > h ? h : w;\n    this.size = this.mw / 2 - m - (config.labelOutside ? f * 3 : 0);\n    this.offset = this.size + this.m + (config.labelOutside ? f * 3 : 0);\n    this.color = d3.scale.ordinal().range(config.palette.colors.map(function(it){return it.hex;}));\n    this.radius = config.radius;\n    this.arc = d3.svg.arc().outerRadius(this.size).innerRadius(config.ringMode ? this.size * 0.7 : 0);\n    return this.data.map(function(it){\n      return it.cv = this$.nvector(this$.arc.centroid(it));\n    });\n  },\n  nvector: function(v){\n    var len;\n    len = Math.sqrt(Math.pow(v[0], 2) + Math.pow(v[1], 2));\n    return [v[0] / len, v[1] / len];\n  },\n  render: function(){\n    var x$, rate, y$, z$, z1$, this$ = this;\n    var root = this.root, config = this.config, data = this.data;\n    this.svg.attr({\n      width: this.w,\n      height: this.h,\n      viewBox: \"0 0 \" + this.mw + \" \" + this.mw,\n      preserveAspectRatio: \"xMidYMid\"\n    });\n    this.g.attr({\n      transform: \"translate(\" + this.offset + \",\" + this.offset + \")\"\n    });\n    x$ = this.g.selectAll('path.wedge');\n    x$.attr({\n      d: this.arc,\n      fill: function(it){\n        return this$.color(it.data.name);\n      }\n    });\n    if (config.labelOutside) {\n      rate = this.size + config.fontSize * 1.5;\n    } else if (config.ringMode) {\n      rate = this.size * 0.85;\n    } else {\n      rate = this.size * 0.8;\n    }\n    y$ = this.g.selectAll('text.value');\n    y$.attr({\n      x: function(it){\n        return this$.nvector(this$.arc.centroid(it))[0] * rate;\n      },\n      y: function(it){\n        return this$.nvector(this$.arc.centroid(it))[1] * rate;\n      },\n      \"text-anchor\": 'middle',\n      opacity: function(){\n        if (config.showLabel) {\n          return 1;\n        } else {\n          return 0;\n        }\n      }\n    });\n    y$.text(function(it){\n      return it.data.percent;\n    });\n    if (!config.labelOutside) {\n      this.g.selectAll('text.value').attr({\n        fill: function(it){\n          if (d3.hsl(this$.color(it.data.name)).l > 0.5) {\n            return '#222';\n          } else {\n            return '#fff';\n          }\n        }\n      });\n    }\n    this.gLegend.attr({\n      transform: \"translate(\" + 2 * (this.size + this.m + (config.labelOutside ? config.fontSize * 3 : 0)) + \",\" + (this.size + this.m - 0.75 * config.fontSize * this.data.length) + \")\"\n    });\n    z$ = this.gLegend.selectAll('rect.legend');\n    z$.attr({\n      x: 0,\n      y: function(d, i){\n        return i * config.fontSize * 1.5;\n      },\n      width: config.fontSize,\n      height: config.fontSize,\n      rx: 3,\n      ry: 3,\n      fill: function(it){\n        return this$.color(it.data.name);\n      }\n    });\n    z1$ = this.gLegend.selectAll('text.legend');\n    z1$.attr({\n      x: function(){\n        return 1.5 * config.fontSize;\n      },\n      y: function(d, i){\n        return i * config.fontSize * 1.5;\n      },\n      \"text-anchor\": 'start',\n      \"dominant-baseline\": 'hanging'\n    });\n    z1$.text(function(it){\n      return it.data.name;\n    });\n    return z1$;\n  }\n});\n","lines":193,"size":6097},"permission":{"switch":["public"],"value":[]},"config":{"padding":{"type":[{"name":"Number","level":3},{"name":"Percent","level":3}],"default":10,"value":10},"margin":{"type":[{"name":"Number","level":3},{"name":"Percent","level":3}],"default":10,"value":"30"},"radius":{"type":[{"name":"Number","level":3}],"default":5,"value":5},"palette":{"type":[{"name":"Palette","level":5,"re":{},"default":{"colors":[{"hex":"#1d3263"},{"hex":"#226c87"},{"hex":"#f8d672"},{"hex":"#e48e11"},{"hex":"#e03215"},{"hex":"#ab2321"}]},"plotdb":{"colors":[{"hex":"#ed1d78"},{"hex":"#c59b6d"},{"hex":"#8cc63f"},{"hex":"#28aae2"}]},"qualitative":{"colors":[{"hex":"#c05ae0"},{"hex":"#cf2d0c"},{"hex":"#e9ab1e"},{"hex":"#86ffb5"},{"hex":"#64dfff"},{"hex":"#003f7d"}]},"binary":{"colors":[{"hex":"#ff8356"},{"hex":"#0076a1"}]},"sequential":{"colors":[{"hex":"#950431"},{"hex":"#be043e"},{"hex":"#ec326d"},{"hex":"#fc82a9"},{"hex":"#febed2"},{"hex":"#fee6ee"}]},"diverging":{"colors":[{"hex":"#74001a"},{"hex":"#cd2149"},{"hex":"#f23971"},{"hex":"#ff84ab"},{"hex":"#ffc3d7"},{"hex":"#f2f2dd"},{"hex":"#b8d9ed"},{"hex":"#81b1d0"},{"hex":"#3d8bb7"},{"hex":"#0071a8"},{"hex":"#003558"}]},"subtype":{"qualitative":"qualitative","binary":"binary","sequential":"sequential","diverging":"diverging"}}],"default":{"colors":[{"hex":"#1d3263"},{"hex":"#226c87"},{"hex":"#f8d672"},{"hex":"#e48e11"},{"hex":"#e03215"},{"hex":"#ab2321"}]},"hint":"qualitative","value":{"colors":[{"hex":"#7d2d21"},{"hex":"#DC5356"},{"hex":"#FFE670"},{"hex":"#dae275"},{"hex":"#4CC786"},{"hex":"#307D99"}],"name":"qualitative"}},"fontSize":{"type":[{"name":"Number","level":3}],"default":12,"value":20},"showLabel":{"type":[{"name":"Boolean","level":2}],"default":true,"value":true},"labelOutside":{"type":[{"name":"Boolean","level":2}],"default":true,"value":false},"ringMode":{"type":[{"name":"Boolean","level":2}],"default":false,"value":true}},"dimension":{"value":{"type":[{"name":"Number","level":3}],"require":true,"fields":[]},"name":{"type":[],"require":false,"fields":[]},"text":{"type":[],"require":false,"fields":[]}},"assets":[],"isType":false,"createdTime":1455695110489,"modifiedTime":1458550850593,"ownerName":"Kirby Wu","likes":0,"parent":null,"basetype":"3","visualencoding":["5","6"],"category":["1"]}