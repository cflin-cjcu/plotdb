{"theme":"1iswwgc","data":[],"name":"Pie Bubble","desc":"bubble size as the summation and pie in bubble for comparison","tags":[""],"owner":"o3tgs6","key":"e92nmd","type":{"name":"chart","location":"server"},"doc":{"name":"document","type":"html","content":"","lines":1,"size":0},"style":{"name":"stylesheet","type":"css","content":"","lines":1,"size":0},"code":{"name":"code","type":"javascript","content":"module = {};\nmodule.exports = plotdb.chart.create({\n  ref: \"http://www.nytimes.com/interactive/2012/09/06/us/politics/convention-word-counts.html#Government\",\n  sample: [0,1,2,3,4,5,6,7,8,9].map(function(it){\n    return {\n      value1: Math.random() * 100,\n      value2: Math.random() * 100,\n      name: [\"John\",\"James\",\"Kirk\",\"Bob\",\"Francis\"][it % 5]\n    };\n  }),\n  dimension: {\n    value1: { type: [plotdb.Number], require: true },\n    value2: { type: [plotdb.Number], require: true },\n    name: { type: [], require: false }\n  },\n  config: {\n    color1: { name: \"Left Pie Color\", type: [plotdb.Color], default: \"#d42\", rebindOnChange: false,\n            hint: plotdb.Color.subtype.positive},\n    color2: { name: \"Right Pie Color\", type: [plotdb.Color], default: \"#24d\", rebindOnChange: false,\n            hint: plotdb.Color.subtype.negative},\n    color3: { name: \"Text Color\", type: [plotdb.Color], default: \"#ffffff\", rebindOnChange: false }\n  },\n  bind: function() {\n    var v1, v2, that = this;\n    for(var idx = 0;idx < this.data.length; idx++) {\n      this.data[idx].value1 = v1 = parseFloat(this.data[idx].value1);\n      this.data[idx].value2 = v2 = parseFloat(this.data[idx].value2);\n      this.data[idx].value = v1 + v2;\n    }\n    this.svg = d3.select(this.root).append(\"svg\").attr({\n      width: \"100%\",\n      height: \"100%\",\n      viewBox: \"0 0 800 600\",\n      preserveAspectRatio: \"xMidYMid\"\n    });\n    this.data.map(function(it) { \n      it.sum = Math.sqrt(it.value1 + it.value2); \n      v1 = it.value1;\n      v2 = it.value2;\n      rate = 0;\n      if(v1 < 0) v1 = 0;\n      if(v2 < 0) v2 = 0;\n      if(v1 + v2 == 0) rate = 0.5;\n      else {\n        rate = v2 / (v1 + v2);\n      }\n      it.rate = rate;\n    });\n    var rscale = d3.scale.linear().domain(\n      d3.extent(this.data.map(function(it){ return it.sum;}))\n    ).range([1000,10000]);\n   this. data.map(function(it) { it.r = Math.sqrt(rscale(it.sum)); });\n   var force = this.force = d3.layout.force();\n   force.size([800,600]).nodes(this.data).charge(function(it) {\n     return -it.r * 15;\n   });\n   force.on(\"tick\",function() { that.tick(); });\n   force.start();\n   nodes = this.data;\n   var circles = this.svg.selectAll(\"g.circle\").data(nodes);\n   circles.enter().append(\"g\").attr(\"class\",\"circle\");\n   circles.exit().remove();\n   this.outline = circles.append(\"circle\").attr(\"class\", \"outline\");\n   this.p1 = circles.append(\"path\").attr(\"class\",\"pie1\");\n   this.p2 = circles.append(\"path\").attr(\"class\",\"pie2\");\n   this.text = circles.append(\"text\").attr(\"class\",\"label\");\n  },\n  tick: function() {\n    var a = this.force.alpha();\n    for(var idx = 0;idx < this.data.length; idx++) {\n      item = this.data[idx];\n      item.x += a * 50 *  ( 0.5 - item.rate );\n    }\n    this.render(this.root, this.data, this.config);\n  },\n  resize: function() {\n  },\n  getptr: function(x,y,r,rate) {\n    var rx = x + r * Math.cos(rate * Math.PI);\n    var ry1 = y - r * Math.sin(rate * Math.PI);\n    var ry2 = y + r * Math.sin(rate * Math.PI);\n\n    return [[rx,ry1],[rx,ry2]]\n  },\n  render: function() {\n    var that = this;\n    this.p1.attr({\n      d: function(it) {\n        ptr = that.getptr(it.x, it.y, it.r, it.rate);\n        return [\n          \"M\", ptr[0][0], ptr[0][1],\n          \"A\", it.r, it.r, 0, (it.value1>it.value2?1:0), 0, ptr[1][0], ptr[1][1],\n          \"L\", it.x, it.y, \n          \"Z\"\n        ].join(\" \")\n      },\n      fill: this.config.color1,\n      stroke: \"none\"\n    });\n    this.p2.attr({\n      d: function(it) {\n        ptr = that.getptr(it.x, it.y, it.r, it.rate);\n        return [\n          \"M\", ptr[0][0], ptr[0][1],\n          \"A\", it.r, it.r, 0, (it.value1>it.value2?0:1), 1, ptr[1][0], ptr[1][1],\n          \"L\", it.x, it.y,\n          \"Z\"\n        ].join(\" \")\n      },\n      fill: this.config.color2,\n      stroke: \"none\"\n    });\n    this.outline.attr({\n      cx: function(it) { return it.x; },\n      cy: function(it) { return it.y; },\n      r: function(it) { return it.r; },\n      fill: \"none\",\n      stroke: \"#fff\",\n      \"stroke-width\": 10\n    });\n    this.text.attr({\n      x: function(it) { return it.x; },\n      y: function(it) { return it.y; },\n      \"text-anchor\": \"middle\",\n      \"dominant-baseline\": \"central\",\n    }).style({\n\t  fill: this.config.color3,\n      \"font-size\": function(it) { \n        var ret = it.r * 1.5 / it.name.length; \n        if(ret < 12) ret = 12;\n        return ret;\n      },\n    }).text(function(it) { return it.name; });\n  }\n});","lines":135,"size":4444},"permission":{"switch":["public"],"value":[{"switch":"public","perm":"fork"}]},"config":{"color1":{"name":"Left Pie Color","type":[{"name":"Color","level":4,"default":"#dc4521","subtype":{"negative":"negative","positive":"positive"}}],"default":"#d42","rebindOnChange":false,"hint":"positive","value":"#71a4a8"},"color2":{"name":"Right Pie Color","type":[{"name":"Color","level":4,"default":"#dc4521","subtype":{"negative":"negative","positive":"positive"}}],"default":"#24d","rebindOnChange":false,"hint":"negative","value":"#e9804f"},"color3":{"name":"Text Color","type":[{"name":"Color","level":4,"default":"#dc4521","subtype":{"negative":"negative","positive":"positive"}}],"default":"#ffffff","rebindOnChange":false,"value":"#ffffff"},"radius":{"_bytheme":true,"type":[{"name":"Number","level":3}],"default":10},"margin":{"_bytheme":true,"type":[{"name":"Number","level":3}],"default":10},"padding":{"_bytheme":true,"type":[{"name":"Number","level":3}],"default":10},"axisInnerTickSize":{"_bytheme":true,"type":[{"name":"Number","level":3}],"default":1},"axisOuterTickSize":{"_bytheme":true,"type":[{"name":"Number","level":3}],"default":1}},"dimension":{"value1":{"type":[{"name":"Number","level":3}],"require":true,"fields":[]},"value2":{"type":[{"name":"Number","level":3}],"require":true,"fields":[]},"name":{"type":[],"require":false,"fields":[]}},"assets":[],"isType":false,"ownerName":"Kirby Wu","likes":0,"parent":null,"createdTime":1458143618798,"basetype":"5","visualencoding":["5","6"],"category":["1","4"],"modifiedTime":1458580008168}