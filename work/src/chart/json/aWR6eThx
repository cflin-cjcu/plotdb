{"theme":"1fater3","basetype":null,"visualencoding":null,"category":null,"data":[],"type":{"location":"server","name":"chart"},"owner":"o3tgs6","key":"idzy8q","permission":{"switch":["public"],"value":[{"switch":"public","perm":"fork"}]},"name":"Grouped Bar Chart","desc":"a standard grouped bar chart","tags":[],"doc":{"name":"document","type":"html","content":"","lines":1,"size":0},"style":{"name":"stylesheet","type":"css","content":"","lines":1,"size":0},"code":{"name":"code","type":"javascript","content":"var module = {};\nmodule.exports = plotdb.chart.create({\n  sample: d3.range(3).map(function(it) {\n    return {\n      value: d3.range(13).map(function(it) { return parseInt(Math.random() * 90); }),\n      category: [\"IT\",\"HR\",\"RD\"][it % 3]\n    };\n  }),\n  dimension: {\n    value: { type: [plotdb.Number], multiple: true, require: true, desc: \"value\" },\n    category: { type: [], require: true, desc: \"group name\"}\n  },\n  config: {\n    fontSize: { name: \"Font Size\", type: [plotdb.Number], default: 12 },\n    margin: { name: \"Margin\", type: [plotdb.Number], default: 10 },\n    padding: { name: \"Padding\", type: [plotdb.Number], default: 10 },\n    palette: { name: \"Palette\", type: [plotdb.Palette], default: plotdb.Palette.default, \n              hint: plotdb.Palette.subtype.qualitative }\n  },\n  init: function() {\n    var that = this;\n    this.svg = d3.select(this.root).append(\"svg\");\n    this.yAxisGroup = this.svg.append(\"g\").attr({class: \"axis vertical\"});\n    this.xAxisGroup = this.svg.append(\"g\").attr({class: \"axis horizontal\"});\n    this.categories = this.data.map(function(it) { return it.category; });\n    this.names = this.dimension.value.fieldName || (this.data[0]?d3.range(this.data[0].value.length || 1):[0]);\n    this.valuerange = d3.extent(this.data\n      .map(function(it) { return it.value; })\n      .reduce(function(a,b) { return a.concat(b); }, [])\n    );\n  },\n  bind: function() {\n    var that = this;\n    this.svg.selectAll(\"g.data-group\").data(this.data)\n    .enter().append(\"g\").attr({class: \"data-group\"}).each(function(d,i) {\n      var node = d3.select(this);\n      node.selectAll(\"rect.data\").data(d.value).enter().append(\"rect\").attr({class: \"data\"});\n      node.selectAll(\"text.label\").data(d.value).enter().append(\"text\").attr({class: \"label\"});\n    });\n    this.xAxisGroup.selectAll(\"g.tick\").data(this.categories)\n    .enter().append(\"g\").attr({class: \"tick\"})\n    .each(function(d,i) {\n      var node = d3.select(this);\n      node.append(\"text\");\n    });\n  },\n  resize: function() {\n    var that = this;\n    var box = this.root.getBoundingClientRect();\n    var width = this.width = box.width;\n    var height = this.height = box.height - 10;\n    var m = this.config.margin;\n    this.yAxisWidth = that.config.fontSize * 5;\n    this.xAxisHeight = that.config.fontSize * 3;\n    this.groupsize = (width - this.yAxisWidth - 2 * m) / (this.categories.length);\n    this.barWidth = (this.groupsize - this.config.padding ) / that.names.length;\n    this.svg.attr({\n      width: width + \"px\", height: height + \"px\",\n      viewBox: [0,0,width,height].join(\" \"),\n      preserveAspectRatio: \"xMidYMid\"\n    });\n    this.yscale = d3.scale.linear().domain([0, this.valuerange[1]]).range([height - m - that.xAxisHeight, m]);\n    this.cscale = d3.scale.ordinal().range(\n      this.config.palette.colors.map(function(it) { return it.hex; })\n    );\n    this.yAxis = d3.svg.axis().orient(\"left\").scale(this.yscale);\n    this.yAxisGroup.call(this.yAxis);\n  },\n  render: function() {\n    var that = this;\n    this.yAxisGroup.attr({\n      transform: \"translate(\" + (that.config.margin + that.yAxisWidth) + \",0)\"\n    });\n    this.xAxisGroup.selectAll(\"text\").attr({\n      x: function(d,i) { \n        return (i + 0.5) * that.groupsize + that.yAxisWidth + that.config.margin;\n      },\n      y: that.height - that.xAxisHeight + that.config.fontSize,\n      \"text-anchor\": \"middle\",\n      \"dominant-baseline\": \"central\"\n    }).text(function(d,i) { return d; });\n    this.svg.selectAll(\"g.data-group\").attr({\n      transform: function(d,i) {\n        return [\"translate(\", (that.config.margin + that.yAxisWidth + that.groupsize * i),\",\", 0,\")\"].join(\"\");\n      }\n    }).each(function(d,i) {\n      var node = d3.select(this);\n      node.selectAll(\"rect\").attr({\n        x: function(d,i) {\n          return i * that.barWidth;\n        },\n        rx: that.config.radius,\n        ry: that.config.radius,\n        y: function(d,i) { return that.yscale(d); },\n        width: that.barWidth,\n        height: function(d,i) { return Math.abs(that.yscale(d) - that.yscale(0)); },\n        fill: function(d,i) { return that.cscale(that.names[i]); }\n      });\n      node.selectAll(\"text\").attr({\n        x: function(d,i) {\n          return (i + 0.5) * that.barWidth;\n        },\n        y: function(d,i) { return that.yscale(d) - that.config.fontSize * 1; },\n        \"text-anchor\": \"middle\",\n        \"dominant-baseline\": \"central\"\n      }).text(function(d,i) { return d; });\n    });\n  }\n});","lines":109,"size":4470},"config":{"fontSize":{"name":"Font Size","type":[{"name":"Number","level":3}],"default":12,"value":20},"margin":{"name":"Margin","type":[{"name":"Number","level":3}],"default":10,"value":10},"padding":{"name":"Padding","type":[{"name":"Number","level":3}],"default":10,"value":10},"palette":{"name":"Palette","type":[{"name":"Palette","level":5,"re":{},"default":{"colors":[{"hex":"#1d3263"},{"hex":"#226c87"},{"hex":"#f8d672"},{"hex":"#e48e11"},{"hex":"#e03215"},{"hex":"#ab2321"}]},"plotdb":{"colors":[{"hex":"#ed1d78"},{"hex":"#c59b6d"},{"hex":"#8cc63f"},{"hex":"#28aae2"}]},"qualitative":{"colors":[{"hex":"#c05ae0"},{"hex":"#cf2d0c"},{"hex":"#e9ab1e"},{"hex":"#86ffb5"},{"hex":"#64dfff"},{"hex":"#003f7d"}]},"binary":{"colors":[{"hex":"#ff8356"},{"hex":"#0076a1"}]},"sequential":{"colors":[{"hex":"#950431"},{"hex":"#be043e"},{"hex":"#ec326d"},{"hex":"#fc82a9"},{"hex":"#febed2"},{"hex":"#fee6ee"}]},"diverging":{"colors":[{"hex":"#74001a"},{"hex":"#cd2149"},{"hex":"#f23971"},{"hex":"#ff84ab"},{"hex":"#ffc3d7"},{"hex":"#f2f2dd"},{"hex":"#b8d9ed"},{"hex":"#81b1d0"},{"hex":"#3d8bb7"},{"hex":"#0071a8"},{"hex":"#003558"}]},"subtype":{"qualitative":"qualitative","binary":"binary","sequential":"sequential","diverging":"diverging"}}],"default":{"colors":[{"hex":"#1d3263"},{"hex":"#226c87"},{"hex":"#f8d672"},{"hex":"#e48e11"},{"hex":"#e03215"},{"hex":"#ab2321"}]},"hint":"qualitative","value":{"colors":[{"hex":"#7d2d21"},{"hex":"#DC5356"},{"hex":"#FFE670"},{"hex":"#dae275"},{"hex":"#4CC786"},{"hex":"#307D99"}]}}},"dimension":{"value":{"type":[{"name":"Number","level":3}],"multiple":true,"require":true,"desc":"value"},"category":{"type":[],"require":true,"desc":"group name"}},"assets":[],"isType":false,"likes":0,"parent":null,"createdTime":1458981778500,"ownerName":"Kirby Wu","modifiedTime":1458983527302}