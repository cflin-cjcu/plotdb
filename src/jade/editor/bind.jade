div(ng-controller="datasetList",ng-cloak)
  include ../dataset/widget/float-edit.jade
  h1 Data Binding
  .sep.dark
  .databinder.row
    .col-sm-4
      .ds-list-panel.panel.panel-default
        .panel-heading
          | choose dataset you want to use ...
        .panel-body
          .input-group
            input.input-sm.form-control(ng-model="filter.search")
            span.input-group-btn: .btn.btn-default.btn-sm: i.fa.fa-search
          .btn.btn-default.btn-sm(ng-click="dataPanel.toggle()") #[i.fa.fa-plus-circle] New Dataset
          .sep
          .ds-list
            .ds-list-item(ng-repeat="dataset in datasets|filter:{name:filter.search}:false",
            ng-click="setcur(dataset)",ng-class="{'active':cur==dataset}")
              img.avatar(ng-attr-src="/s/avatar/{{dataset.owneravatar || 0}}.jpg")
              div(style="display:inline-block")
                .name {{dataset.name}}
                .grayed {{dataset.rows}} Rows, {{dataset.fields.length}} Fields
              small.grayed.pull-right(ng-show="dataset.isSample") sample data
            .text-center.grayed that's all. #[i.fa.fa-smile-o]
            .text-center.grayed no result. try other keyword?

    .col-sm-8
      .ds-fields-panel.panel.panel-default
        .panel-heading
          | Field List
        .panel-body
          .pull-right
            a(ng-attr-href="/dataset/{{cur.key}}/",target="_blank") #[i.fa.fa-external-link]
          label
            .ball(ng-class="{'active':cur}")
            span(ng-cloak,ng-show="cur") {{cur.name}}
          span.grayed(ng-show="!cur") ( no dataset select ... )
          .info
            small.grayed(ng-show="cur") {{cur.rows}} Rows, {{cur.fields.length}} Fields
            span &nbsp;
          .sep
          #field-agent.ds-field(ng-drag="true",ng-drag-data="fieldAgent.data",
          ng-drag-start="fieldAgent.drag.start()",ng-drag-stop="fieldAgent.drag.end()",
          ng-class="{'active':fieldAgent.data}")
            i.fa.fa-bars
            .detail
              .name {{fieldAgent.data.name || '(empty)'}}&nbsp;
              .grayed: small {{fieldAgent.data.type || 'Any'}}
          .ds-fields
            .ds-field(ng-repeat="field in cur.fields",ng-mouseover="fieldAgent.setProxy($event,field)",
            ng-drag="true",ng-drag-data="field")
              i.fa.fa-bars
              .detail
                .name {{field.name || '(empty)'}}&nbsp;
                .grayed: small {{field.type || 'Any'}}

            .ds-field.flexend(style="cursor:default")

      .text-center.grayed #[i.fa.fa-arrow-down] Drag Field to Map Dimension #[i.fa.fa-arrow-down]
      .chart-dims(ng-cloak)
        .chart-dim.panel.panel-default(ng-repeat="(name,dim) in chart.dimension",
        ng-drop="true",ng-drop-success="dimension.bind($event,dim,$data)")
          .panel-heading dimension
          .panel-body
            b {{name}}
            .desc {{dim.desc}}
            .grayed accept: 
              i(ng-repeat="type in dim.type") {{type.name}}
              i(ng-show="!dim.type || !dim.type.length") Any
            .ds-fields
              .ds-field.placeholder(ng-show="!dim.fields || !dim.fields.length")
              .ds-field(ng-repeat="field in dim.fields")
                .delete(ng-click="dimension.unbind($event, dim, field)"): span &times;
                .name {{field.name}}&nbsp;
                small.grayed in appworksout
        .chart-dim.flexend
