// Generated by LiveScript 1.3.1
var gridRender;
gridRender = function(e){
  var htmlCharMap, escape, data, types, ohlen, len, ref$, res$, i$, to$, i, w, ths, j, trs;
  htmlCharMap = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#039;'
  };
  escape = function(text){
    text == null && (text = "");
    return text.replace(/[&<>"']/g, function(m){
      return htmlCharMap[m];
    });
  };
  data = e.data;
  types = data.types || [];
  ohlen = data.headers.length;
  len = {
    head: data.headers.length < 10
      ? 10
      : data.headers.length + 1,
    rows: (data.rows || (data.rows = [])).length < 100
      ? 100
      : ((ref$ = data.rows).length || (ref$.length = [])) + 10
  };
  res$ = [];
  for (i$ = 0, to$ = len.head; i$ < to$; ++i$) {
    i = i$;
    res$.push(data.headers[i] || '');
  }
  data.headers = res$;
  w = 100 / len.head + "%";
  if (len.head > 10) {
    w = "10%";
  }
  ths = "<div>" + data.headers.map(function(d, i){
    var that;
    return ["<div style='width:" + w + "'>", "<div contenteditable='true' col='" + i + "' class='" + (i < ohlen ? 'in-use' : '') + "'>", d ? "&nbsp;" + escape(d) : "", "</div><small class='grayed'>&nbsp;", i < ohlen ? (that = types[i]) ? that : 'ANY' : '', "</small></div>"].join("");
  }).join("") + "</div>";
  if (!data.rows) {
    return postMessage({
      ths: ths
    });
  }
  res$ = [];
  for (i$ = 0, to$ = len.rows; i$ < to$; ++i$) {
    i = i$;
    res$.push(data.rows[i] || (fn$()));
  }
  data.rows = res$;
  trs = data.rows.map(function(row, i){
    return "<div>" + data.headers.map(function(d, j){
      return "<div contenteditable='true' row='" + i + "' col='" + j + "' style='width:" + w + "'>" + (escape(row[j]) || '') + "</div>";
    }).join("") + "</div>";
  });
  return {
    trs: trs,
    ths: ths
  };
  function fn$(){
    var i$, to$, results$ = [];
    for (i$ = 0, to$ = len.head; i$ < to$; ++i$) {
      j = i$;
      results$.push('');
    }
    return results$;
  }
};