// Generated by LiveScript 1.3.1
var x$;
x$ = angular.module('plotDB');
x$.controller('userSelection', ['$scope', '$http', 'plNotify', 'teamService'].concat(function($scope, $http, plNotify, teamService){
  console.log('123');
  $scope.save = function(){
    var members, team;
    members = $('#search-user').val();
    team = new teamService.team();
    team.name = $scope.name;
    team.description = $scope.description;
    return $http({
      url: '/d/team/',
      method: 'POST',
      data: {
        team: team,
        members: members
      }
    }).success(function(d){
      return plNotify.send('success', "team created.");
    }).error(function(d){
      return plNotify.send('error', "failed creating team. try again later?");
    });
  };
  $('#search-user-team').select2({
    ajax: {
      url: "http://localhost/d/user/?team=true",
      dataType: "json",
      delay: 250,
      data: function(params){
        return {
          keyword: params.term,
          offset: (params.page || 0) * 20,
          limit: 20
        };
      },
      processResults: function(data, params){
        params.page = params.page || 0;
        return {
          results: data.map(function(it){
            return it.id = it.type + ":" + it.key, it;
          }),
          pagination: {
            more: data && data.length
          }
        };
      },
      cache: true
    },
    escapeMarkup: function(it){
      return it;
    },
    minimumInputLength: 1,
    templateResult: function(it){
      if (!it || !it.displayname) {
        return "<img src='/assets/img/loading.gif'>";
      }
      return "<div class=\"select2-user\">\n<img src=\"/s/avatar/" + (it.avatar || 0) + ".jpg\">\n<span>" + it.displayname + "</span>\n<small class=\"grayed\">" + (it.type === "team" ? "(team)" : "") + "</small>\n</div>";
    },
    templateSelection: function(it){
      return "<div class=\"select2-user selected\">\n<img src=\"/s/avatar/" + (it.avatar || 0) + ".jpg\">\n<span>" + it.displayname + "</span>\n<small class=\"grayed\">" + (it.type === "team" ? "(team)" : "") + "</small>\n</div>";
    }
  });
  return $('#search-user').select2({
    ajax: {
      url: "http://localhost/d/user/",
      dataType: "json",
      delay: 250,
      data: function(params){
        params.num = parseInt(Math.random() * 100);
        return {
          keyword: params.term,
          offset: (params.page || 0) * 20,
          limit: 20
        };
      },
      processResults: function(data, params){
        params.page = params.page || 0;
        return {
          results: data.map(function(it){
            return it.id = it.key, it;
          }),
          pagination: {
            more: data && data.length
          }
        };
      },
      cache: true
    },
    escapeMarkup: function(it){
      return it;
    },
    minimumInputLength: 1,
    templateResult: function(it){
      if (!it || !it.displayname) {
        return "<img src='/assets/img/loading.gif'>";
      }
      return "<div class=\"select2-user\">\n<img src=\"/s/avatar/" + (it.avatar || 0) + ".jpg\">\n<span>" + it.displayname + "</span>\n</div>";
    },
    templateSelection: function(it){
      return "<div class=\"select2-user selected\">\n<img src=\"/s/avatar/" + (it.avatar || 0) + ".jpg\">\n<span>" + it.displayname + "</span>\n</div>";
    }
  });
}));