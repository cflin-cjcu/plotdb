// Generated by LiveScript 1.3.1
var x$;
x$ = angular.module('plotDB');
x$.controller('payment', ['$scope', '$http', 'plNotify', 'eventBus'].concat(function($scope, $http, plNotify, eventBus){
  Stripe.setPublishableKey('pk_test_DE53QFrgknntLkCNsVr1MqrV');
  $scope.payinfo = {};
  return $scope.createToken = function(){
    eventBus.fire('loading.dimmer.on');
    return Stripe.card.createToken($scope.payinfo, function(state, res){
      console.log("result from Stripe");
      console.log("status code: ", state);
      console.log(res);
      return $http({
        url: '/d/testpay',
        method: 'POST',
        data: res
      }).success(function(d){
        plNotify.send('success', "you've subscribed!");
        return eventBus.fire('loading.dimmer.off');
      }).error(function(d){
        plNotify.send('danger', "something wrong, try again later? ");
        return eventBus.fire('loading.dimmer.off');
      });
    });
  };
}));