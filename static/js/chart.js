function import$(t,e){var n={}.hasOwnProperty;for(var o in e)n.call(e,o)&&(t[o]=e[o]);return t}var x$;x$=angular.module("plotDB"),x$.filter("tags",function(){return function(t){return(t||"").split(",")}}),x$.controller("chartEditor",["$scope","$timeout","dataService","sampleChart"].concat(function(t,e,n,o){var r,a,i,c;return t.plotdomain="http://localhost/",t.vis="preview",t.showsrc=!0,t.chart={init:function(){return t.chart.code.content=o.code.content},setdim:function(t,e,o){var r;return null==t&&(t={}),(r=n.find(t))?(n.field.update(t),o.fields=[t],this.render()):void 0},render:function(){function e(t){return"Number"===t.name}var n,o,r,a,i,c,s,l,d,u,f,p,h,m,g;n=[];for(o in r=this.dimensions||(this.dimensions={})){if(a=r[o],a.fields&&a.fields.length&&a.fields[0].data&&a.fields[0].data.length)break;a=null}if(a)for(i=0,c=a.fields[0].data.length;c>i;++i){s=i,l={};for(d in r=this.dimensions)u=r[d],f=(u.fields||(u.fields=[]))[0],l[d]=f?(f.data||(f.data=[]))[s]:null,u.type.filter(e).length&&(l[d]=parseFloat(l[d]));n.push(l)}return p=import$({},this.configs),m={data:n,config:p},m.doc=(r=t.chart).doc,m.style=r.style,m.code=r.code,h=m,g=document.getElementById("visualizer"),g.contentWindow.postMessage({type:"render",payload:h},t.plotdomain)},doc:{option:{mode:"xml",lineWrapping:!0,lineNumbers:!0},content:""},style:{option:{mode:"css",lineWrapping:!0,lineNumbers:!0},content:""},code:{option:{mode:"javascript",lineWrapping:!0,lineNumbers:!0},content:"function() {}"}},t.switchPanel=function(){var e;return e=t.vis,t.vis="preview"===t.vis&&t.oldvis?t.oldvis:"preview"===t.vis?"code":"preview","preview"!==e?t.oldvis=e:void 0},t.codemirrored=function(t){var e;return e=function(){},t.setOption("extraKeys",{"Cmd-Enter":e,"Alt-Enter":e})},document.body.addEventListener("keydown",function(e){return!e.metaKey&&!e.altKey||13!==e.keyCode&&13!==e.which?void 0:t.$apply(function(){return t.switchPanel()})}),t.chart.init(),r=function(){var e,n,o,r,a=[];for(e=0,o=(n=["code","style","doc"]).length;o>e;++e)r=n[e],t.chart[r].lines=t.chart[r].content.split("\n").length,a.push(t.chart[r].size=t.chart[r].content.length);return a},t.$watch("chart.doc.content",r),t.$watch("chart.style.content",r),t.$watch("chart.code.content",r),t.$watch("chart.doc.content",function(){return t.chart.render()}),t.$watch("chart.style.content",function(){return t.chart.render()}),t.$watch("chart.code.content",function(e){return visualizer.contentWindow.postMessage({type:"parse",payload:e},t.plotdomain)}),t.$watch("chart.configs",function(){return t.chart.render()},!0),window.addEventListener("message",function(e){var n,o,r,a,i,c,s;if(n=e.data,n&&typeof n==typeof{}){if("error"===n.type)return t.$apply(function(){return t.codeError=n.payload});if("alt-enter"===n.type)return t.$apply(function(){return t.vis="code"});if("snapshot"===n.type)return t.chart.thumbnail=n.payload,t.save(t.chart.isType);if("parse"===n.type){o=JSON.parse(n.payload),r=o.config,a=o.mapping;for(i in o=(c=t.chart).configs||(c.configs={}))s=o[i],r[i]&&(r[i].value=s.value);for(i in r)s=r[i],r[i].value||(r[i].value=r[i]["default"]);for(i in o=(c=t.chart).dimensions||(c.dimensions={}))s=o[i],a[i]&&(a[i].fields=s.fields);return o=t.chart,o.dimensions=a,o.configs=r,t.chart.render()}return"loaded"===n.type?visualizer.contentWindow.postMessage({type:"parse",payload:((o=t.chart).code||(o.code={})).content},t.plotdomain):void 0}},!1),t.save=function(e){var n,o,r,a,i,c,s,l,d,u,f,p,h;null==e&&(e=!1),n=t.chart,n.thumbnail||visualizer.contentWindow.postMessage({type:"snapshot"},t.plotdomain),n.isType=e,o={};for(r in a=n.dimensions)for(i=a[r],o[r]=import$({},i),c=0,d=(s=(l=o[r]).fields||(l.fields=[])).length;d>c;++c)u=s[c],delete u.data;if(e)for(r in o)i=o[r],i.fields=[];return f={doc:n.doc.content,style:n.style.content,code:n.code.content,config:n.configs,dimension:o,thumbnail:n.thumbnail,isType:n.isType},f.name=t.name,f.desc=t.desc,f.tags=t.tags,p=e?"charttype":"charts",h=JSON.parse(localStorage.getItem("/list/"+p))||[],h.indexOf(t.name)<0&&(h.push(t.name),localStorage.setItem("/list/"+p,angular.toJson(h.filter(function(t){return t})))),localStorage.setItem("/"+p+"/"+t.name,angular.toJson(f)),setTimeout(function(){var e;return e=JSON.parse(localStorage.getItem("/"+p+"/"+t.name))},1e3)},t.load=function(e,o){var r,a,i,c,s,l,d,u,f,p,h,m;if(null==o&&(o=!1),null==e&&(e=t.name),e){for(r=o?"charttype":"charts",a=JSON.parse(localStorage.getItem("/"+r+"/"+e)),i=t.chart,i.code.content=a.code,i.doc.content=a.doc,i.style.content=a.style,i.configs=a.config,i.dimensions=a.dimension,t.desc=a.desc,t.tags=a.tags,c={},s=0,d=(l=n.datasets).length;d>s;++s)u=l[s],c[u.key]=u,u.toggle=!1;for(f in l=a.dimension)for(p=l[f],h=p.fields,p.fields=[],s=0,d=h.length;d>s;++s)m=h[s],t.chart.setdim(m,{},p),c[m.dataset]&&(c[m.dataset].toggle=!0);return i.render()}},t.datacreate=function(){return t.showDataCreateModal=!t.showDataCreateModal},(a=window.location.search)&&(i=/[?&]name=([^&#]+)/.exec(a))?(t.name=i[1],i=/[?&]type=([^&#]+)/.exec(window.location.search),c=i&&"true"===i[1]?!0:!1,t.load(t.name,c)):void 0})),x$.controller("mychart",["$scope","dataService"].concat(function(t){var e;return t.mycharts=[],e=JSON.parse(localStorage.getItem("/list/charts"))||[],t.mycharts=e.map(function(t){var e;return e=JSON.parse(localStorage.getItem("/charts/"+t))}).filter(function(t){return t}),t["goto"]=function(t){return window.location.href="/chart.html?name="+t.name}}));