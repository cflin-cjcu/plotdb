function import$(e,t){var n={}.hasOwnProperty;for(var r in t)n.call(t,r)&&(e[r]=t[r]);return e}var x$;x$=angular.module("plotDB"),x$.controller("chartEditor",["$scope","dataService","sampleChart"].concat(function(e,t,n){return e.vis="preview",e.showsrc=!0,e.chart={init:function(){return e.chart.code.content=n.code.content},setdim:function(e,n,r){var o;return null==e&&(e={}),(o=t.datasets.filter(function(t){return t.key===e.file})[0])?(e.data=(o.data||(o.data=[])).map(function(t){return t[e.name]}),r.fields=[e],this.render()):void 0},render:function(){var t,n,r,o,i,s,a,c,l,d,f,u,m,h;t=[],console.log(this.dimensions);for(n in r=this.dimensions||(this.dimensions={})){if(o=r[n],o.fields&&o.fields.length&&o.fields[0].data&&o.fields[0].data.length)break;o=null}if(o)for(i=0,s=o.fields[0].data.length;s>i;++i){a=i,c={};for(n in r=this.dimensions)l=r[n],d=(l.fields||(l.fields=[]))[0],c[l.name]=d?(d.data||(d.data=[]))[a]:null;t.push(c)}return f={},import$(f,this.configs),m={data:t,config:f},m.doc=(r=e.chart).doc,m.style=r.style,m.code=r.code,u=m,h=document.getElementById("visualizer"),h.contentWindow.postMessage(u,"http://localhost/")},doc:{option:{mode:"xml",lineWrapping:!0,lineNumbers:!0},content:""},style:{option:{mode:"css",lineWrapping:!0,lineNumbers:!0},content:""},code:{option:{mode:"javascript",lineWrapping:!0,lineNumbers:!0},content:"function() {}"}},e.chart.init(),setTimeout(function(){return e.chart.render()},1e3),e.$watch("chart.code.content",function(t){function n(e){return e.replace(/plotdb\./,"").trim()}function r(e){return e}function o(e){return e.replace(/plotdb\./,"").trim()}function i(e){return e}var s,a,c,l,d,f,u,m,h,g,p,v,y,$,x,S,N,w,O,I,b;for(s=[t.split("\n"),[],[]],a=s[0],c=s[1],l=s[2],s=[{},{}],d=s[0],f=s[1],u=0,m=0,h=a.length;h>m&&(g=a[m],!/^\s*}\s*,\s*$/.exec(g)||1!==u);++m)1===u&&c.push(g),/^\s*mapping\s*:\s*{\s*$/.exec(g)&&(u=1);for(u=0,m=0,h=a.length;h>m&&(g=a[m],!/^\s*}\s*,\s*$/.exec(g)||1!==u);++m)1===u&&l.push(g),/^\s*config\s*:\s*{\s*$/.exec(g)&&(u=1);for(m=0,h=c.length;h>m;++m)p=c[m],v=/(\S+)\s*:\s*{/.exec(p),v&&(y=v[1],v=/type\s*:\s*\[([^\]]*)\]/.exec(p),v&&($=v[1].split(",").map(n).filter(r),v=/require: (true|false)/.exec(p),v&&(x="true"===v[1]?!0:!1,d[y]={name:y,type:$,require:x})));for(m=0,h=l.length;h>m;++m)S=l[m],v=/(\S+)\s*:\s*{/.exec(S),v&&(y=v[1],v=/type\s*:\s*\[([^\]]*)\]/.exec(S),v&&($=v[1].split(",").map(o).filter(i),v=/default: ("[^"]+"|'[^']+'|null|\d+)/.exec(S),v&&(N=v[1],f[y]={name:y,type:$,defval:N,value:N})));for(w in d)O=d[w],null==((s=e.chart).dimensions||(s.dimensions={}))[w]&&(((s=e.chart).dimensions||(s.dimensions={}))[w]=O);for(w in s=(I=e.chart).dimensions||(I.dimensions={}))O=s[w],null==d[w]?delete e.chart.dimensions[w]:import$(e.chart.dimensions[w],d[w]);for(w in f)O=f[w],null==((s=e.chart).configs||(s.configs={}))[w]&&(((s=e.chart).configs||(s.configs={}))[w]=O);for(w in s=(I=e.chart).configs||(I.configs={}))O=s[w],null==f[w]?delete e.chart.configs[w]:(b=O.value,import$(O,f[w]),O.value===O.defval&&(O.value=b));return e.chart.render()}),e.$watch("chart.configs",function(){return e.chart.render()},!0),e.save=function(){var t,n,r,o,i,s,a,c,l,d,f,u;t=e.chart,n={};for(r in o=t.dimensions)for(i=o[r],n[r]=import$({},i),s=0,l=(a=(c=n[r]).fields||(c.fields=[])).length;l>s;++s)d=a[s],delete d.data;return f={doc:t.doc.content,style:t.style.content,code:t.code.content,config:t.configs,dimension:n},f.name=e.name,u=JSON.parse(localStorage.getItem("/list/charts"))||[],u.indexOf(e.name)<0&&(u.push(e.name),localStorage.setItem("/list/charts",JSON.stringify(u))),localStorage.setItem("/charts/"+e.name,JSON.stringify(f))},e.load=function(n){var r,o,i,s,a,c,l,d,f,u,m,h;if(null==n&&(n=e.name),n){for(r=JSON.parse(localStorage.getItem("/charts/"+n)),o=e.chart,o.code.content=r.code,o.doc.content=r.doc,o.style.content=r.style,o.configs=r.config,o.dimensions=r.dimension,i={},s=0,c=(a=t.datasets).length;c>s;++s)l=a[s],i[l.key]=l,l.toggle=!1;for(s=0,c=(a=r.dimension).length;c>s;++s)for(d=a[s],f=0,m=(u=l.fields||(l.fields=[])).length;m>f;++f)h=u[f],e.chart.setdim(h,{},d),i[h.file]&&(i[h.file].toggle=!0);return o.render()}},e.datacreate=function(){return e.showDataCreateModal=!e.showDataCreateModal}})),x$.controller("mychart",["$scope","dataService"].concat(function(e){var t;return e.mycharts=[],t=JSON.parse(localStorage.getItem("/list/charts"))||[],e.mycharts=t.map(function(e){var t;return t=JSON.parse(localStorage.getItem("/charts/"+e))})}));