function import$(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}var x$;x$=angular.module("plotDB"),x$.filter("tags",function(){return function(t){return(t||"").split(",")}}),x$.controller("chartEditor",["$scope","$timeout","dataService","sampleChart"].concat(function(t,e,n,r){var o,a,i,c;return t.vis="preview",t.showsrc=!0,t.chart={init:function(){return t.chart.code.content=r.code.content},setdim:function(t,e,r){var o;return null==t&&(t={}),(o=n.find(t))?(n.field.update(t),r.fields=[t],this.render()):void 0},render:function(){function e(t){return"Number"===t.name}var n,r,o,a,i,c,s,l,d,u,f,h,p,m,g;n=[];for(r in o=this.dimensions||(this.dimensions={})){if(a=o[r],a.fields&&a.fields.length&&a.fields[0].data&&a.fields[0].data.length)break;a=null}if(a)for(i=0,c=a.fields[0].data.length;c>i;++i){s=i,l={};for(d in o=this.dimensions)u=o[d],f=(u.fields||(u.fields=[]))[0],l[d]=f?(f.data||(f.data=[]))[s]:null,u.type.filter(e).length&&(l[d]=parseFloat(l[d]));n.push(l)}return h=import$({},this.configs),m={data:n,config:h},m.doc=(o=t.chart).doc,m.style=o.style,m.code=o.code,p=m,g=document.getElementById("visualizer"),g.contentWindow.postMessage({type:"render",payload:p},"http://localhost/")},doc:{option:{mode:"xml",lineWrapping:!0,lineNumbers:!0},content:""},style:{option:{mode:"css",lineWrapping:!0,lineNumbers:!0},content:""},code:{option:{mode:"javascript",lineWrapping:!0,lineNumbers:!0},content:"function() {}"}},t.switchPanel=function(){var e;return e=t.vis,t.vis="preview"===t.vis&&t.oldvis?t.oldvis:"preview"===t.vis?"code":"preview","preview"!==e?t.oldvis=e:void 0},t.codemirrored=function(t){var e;return e=function(){},t.setOption("extraKeys",{"Cmd-Enter":e,"Alt-Enter":e})},document.body.addEventListener("keydown",function(e){return!e.metaKey&&!e.altKey||13!==e.keyCode&&13!==e.which?void 0:t.$apply(function(){return t.switchPanel()})}),t.chart.init(),setTimeout(function(){return t.chart.render()},1e3),o=function(){var e,n,r,o,a=[];for(e=0,r=(n=["code","style","doc"]).length;r>e;++e)o=n[e],t.chart[o].lines=t.chart[o].content.split("\n").length,a.push(t.chart[o].size=t.chart[o].content.length);return a},t.$watch("chart.doc.content",o),t.$watch("chart.style.content",o),t.$watch("chart.code.content",o),t.$watch("chart.doc.content",function(){return t.chart.render()}),t.$watch("chart.style.content",function(){return t.chart.render()}),t.$watch("chart.code.content",function(t){return visualizer.contentWindow.postMessage({type:"parse",payload:t},"http://localhost/")}),t.$watch("chart.configs",function(){return t.chart.render()},!0),window.addEventListener("message",function(e){var n,r,o,a,i,c,s;if(n=e.data){if("error"===n.type)return t.codeError=n.payload;if("alt-enter"===n.type)return t.$apply(function(){return t.vis="code"});if("snapshot"===n.type)return t.chart.thumbnail=n.payload,t.save(t.chart.isType);if("parse"===n.type){r=JSON.parse(n.payload),o=r.config,a=r.mapping;for(i in r=(c=t.chart).configs||(c.configs={}))s=r[i],o[i]&&(o[i].value=s.value);for(i in o)s=o[i],o[i].value||(o[i].value=o[i]["default"]);for(i in r=(c=t.chart).dimensions||(c.dimensions={}))s=r[i],a[i]&&(a[i].fields=s.fields);return r=t.chart,r.dimensions=a,r.configs=o,t.chart.render()}}},!1),t.save=function(e){var n,r,o,a,i,c,s,l,d,u,f,h,p;null==e&&(e=!1),n=t.chart,n.thumbnail||visualizer.contentWindow.postMessage({type:"snapshot"},"http://localhost/"),n.isType=e,r={};for(o in a=n.dimensions)for(i=a[o],r[o]=import$({},i),c=0,d=(s=(l=r[o]).fields||(l.fields=[])).length;d>c;++c)u=s[c],delete u.data;if(e)for(o in r)i=r[o],i.fields=[];return f={doc:n.doc.content,style:n.style.content,code:n.code.content,config:n.configs,dimension:r,thumbnail:n.thumbnail,isType:n.isType},f.name=t.name,f.desc=t.desc,f.tags=t.tags,h=e?"charttype":"charts",p=JSON.parse(localStorage.getItem("/list/"+h))||[],p.indexOf(t.name)<0&&(p.push(t.name),localStorage.setItem("/list/"+h,angular.toJson(p.filter(function(t){return t})))),localStorage.setItem("/"+h+"/"+t.name,angular.toJson(f)),setTimeout(function(){var e;return e=JSON.parse(localStorage.getItem("/"+h+"/"+t.name))},1e3)},t.load=function(e,r){var o,a,i,c,s,l,d,u,f,h,p,m;if(null==r&&(r=!1),null==e&&(e=t.name),e){for(o=r?"charttype":"charts",a=JSON.parse(localStorage.getItem("/"+o+"/"+e)),i=t.chart,i.code.content=a.code,i.doc.content=a.doc,i.style.content=a.style,i.configs=a.config,i.dimensions=a.dimension,t.desc=a.desc,t.tags=a.tags,c={},s=0,d=(l=n.datasets).length;d>s;++s)u=l[s],c[u.id]=u,u.toggle=!1;for(f in l=a.dimension)for(h=l[f],p=h.fields,h.fields=[],s=0,d=p.length;d>s;++s)m=p[s],t.chart.setdim(m,{},h),c[m.dataset]&&(c[m.dataset].toggle=!0);return i.render()}},t.datacreate=function(){return t.showDataCreateModal=!t.showDataCreateModal},(a=window.location.search)&&(i=/[?&]name=([^&#]+)/.exec(a))?(t.name=i[1],i=/[?&]type=([^&#]+)/.exec(window.location.search),c=i&&"true"===i[1]?!0:!1,t.load(t.name,c)):void 0})),x$.controller("mychart",["$scope","dataService"].concat(function(t){var e;return t.mycharts=[],e=JSON.parse(localStorage.getItem("/list/charts"))||[],t.mycharts=e.map(function(t){var e;return e=JSON.parse(localStorage.getItem("/charts/"+t))}).filter(function(t){return t}),t["goto"]=function(t){return window.location.href="/chart.html?name="+t.name}}));