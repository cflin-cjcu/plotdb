function import$(e,t){var n={}.hasOwnProperty;for(var r in t)n.call(t,r)&&(e[r]=t[r]);return e}var x$;x$=angular.module("plotDB"),x$.controller("chartEditor",["$scope","dataService","sampleChart"].concat(function(e,t,n){var r,o;return e.vis="preview",e.showsrc=!0,e.chart={init:function(){return e.chart.code.content=n.code.content},setdim:function(e,n,r){var o;return null==e&&(e={}),(o=t.find(e))?(t.field.update(e),r.fields=[e],this.render()):void 0},render:function(){var t,n,r,o,a,i,s,c,l,d,f,u,m,h;t=[];for(n in r=this.dimensions||(this.dimensions={})){if(o=r[n],o.fields&&o.fields.length&&o.fields[0].data&&o.fields[0].data.length)break;o=null}if(o)for(a=0,i=o.fields[0].data.length;i>a;++a){s=a,c={};for(n in r=this.dimensions)l=r[n],d=(l.fields||(l.fields=[]))[0],c[l.name]=d?(d.data||(d.data=[]))[s]:null;t.push(c)}return f={},import$(f,this.configs),m={data:t,config:f},m.doc=(r=e.chart).doc,m.style=r.style,m.code=r.code,u=m,h=document.getElementById("visualizer"),h.contentWindow.postMessage(u,"http://localhost/")},doc:{option:{mode:"xml",lineWrapping:!0,lineNumbers:!0},content:""},style:{option:{mode:"css",lineWrapping:!0,lineNumbers:!0},content:""},code:{option:{mode:"javascript",lineWrapping:!0,lineNumbers:!0},content:"function() {}"}},e.chart.init(),setTimeout(function(){return e.chart.render()},1e3),e.$watch("chart.code.content",function(t){function n(e){return e.replace(/plotdb\./,"").trim()}function r(e){return e}function o(e){return e.replace(/plotdb\./,"").trim()}function a(e){return e}var i,s,c,l,d,f,u,m,h,g,p,v,x,$,y,S,w,I,N,J,O;for(i=[t.split("\n"),[],[]],s=i[0],c=i[1],l=i[2],i=[{},{}],d=i[0],f=i[1],u=0,m=0,h=s.length;h>m&&(g=s[m],!/^\s*}\s*,\s*$/.exec(g)||1!==u);++m)1===u&&c.push(g),/^\s*mapping\s*:\s*{\s*$/.exec(g)&&(u=1);for(u=0,m=0,h=s.length;h>m&&(g=s[m],!/^\s*}\s*,\s*$/.exec(g)||1!==u);++m)1===u&&l.push(g),/^\s*config\s*:\s*{\s*$/.exec(g)&&(u=1);for(m=0,h=c.length;h>m;++m)p=c[m],v=/(\S+)\s*:\s*{/.exec(p),v&&(x=v[1],v=/type\s*:\s*\[([^\]]*)\]/.exec(p),v&&($=v[1].split(",").map(n).filter(r),v=/require: (true|false)/.exec(p),v&&(y="true"===v[1]?!0:!1,d[x]={name:x,type:$,require:y})));for(m=0,h=l.length;h>m;++m)S=l[m],v=/(\S+)\s*:\s*{/.exec(S),v&&(x=v[1],v=/type\s*:\s*\[([^\]]*)\]/.exec(S),v&&($=v[1].split(",").map(o).filter(a),v=/default: ("[^"]+"|'[^']+'|null|\d+)/.exec(S),v&&(w=v[1],f[x]={name:x,type:$,defval:w,value:w})));for(I in d)N=d[I],null==((i=e.chart).dimensions||(i.dimensions={}))[I]&&(((i=e.chart).dimensions||(i.dimensions={}))[I]=N);for(I in i=(J=e.chart).dimensions||(J.dimensions={}))N=i[I],null==d[I]?delete e.chart.dimensions[I]:import$(e.chart.dimensions[I],d[I]);for(I in f)N=f[I],null==((i=e.chart).configs||(i.configs={}))[I]&&(((i=e.chart).configs||(i.configs={}))[I]=N);for(I in i=(J=e.chart).configs||(J.configs={}))N=i[I],null==f[I]?delete e.chart.configs[I]:(O=N.value,import$(N,f[I]),N.value===N.defval&&(N.value=O));return e.chart.render()}),e.$watch("chart.configs",function(){return e.chart.render()},!0),e.save=function(){var t,n,r,o,a,i,s,c,l,d,f,u;t=e.chart,n={};for(r in o=t.dimensions)for(a=o[r],n[r]=import$({},a),i=0,l=(s=(c=n[r]).fields||(c.fields=[])).length;l>i;++i)d=s[i],delete d.data;return f={doc:t.doc.content,style:t.style.content,code:t.code.content,config:t.configs,dimension:n},f.name=e.name,u=JSON.parse(localStorage.getItem("/list/charts"))||[],u.indexOf(e.name)<0&&(u.push(e.name),localStorage.setItem("/list/charts",angular.toJson(u.filter(function(e){return e})))),localStorage.setItem("/charts/"+e.name,angular.toJson(f)),setTimeout(function(){var t;return t=JSON.parse(localStorage.getItem("/charts/"+e.name))},1e3)},e.load=function(n){var r,o,a,i,s,c,l,d,f,u,m;if(null==n&&(n=e.name),n){for(r=JSON.parse(localStorage.getItem("/charts/"+n)),o=e.chart,o.code.content=r.code,o.doc.content=r.doc,o.style.content=r.style,o.configs=r.config,o.dimensions=r.dimension,a={},i=0,c=(s=t.datasets).length;c>i;++i)l=s[i],a[l.id]=l,l.toggle=!1;for(d in s=r.dimension)for(f=s[d],u=f.fields,f.fields=[],i=0,c=u.length;c>i;++i)m=u[i],e.chart.setdim(m,{},f),a[m.dataset]&&(a[m.dataset].toggle=!0);return o.render()}},e.datacreate=function(){return e.showDataCreateModal=!e.showDataCreateModal},(r=window.location.search)&&(o=/[?&]name=([^&#]+)/.exec(r))?(e.name=o[1],e.load(e.name)):void 0})),x$.controller("mychart",["$scope","dataService"].concat(function(e){var t;return e.mycharts=[],t=JSON.parse(localStorage.getItem("/list/charts"))||[],e.mycharts=t.map(function(e){var t;return t=JSON.parse(localStorage.getItem("/charts/"+e))}).filter(function(e){return e}),e["goto"]=function(e){return window.location.href="/chart.html?name="+e.name}}));