function import$(t,e){var a={}.hasOwnProperty;for(var n in e)a.call(e,n)&&(t[n]=e[n]);return t}var x$;x$=angular.module("plotDB"),x$.service("sampleData",["$rootScope"].concat(function(){return[{name:"Population2015.csv",size:"456KB",rows:"72",color:"#f99",key:1,fields:[{name:"population",type:"Number",file:1},{name:"date",type:"Date",file:1}]},{name:"Agriculture.csv",size:"73KB",rows:"15",color:"#9f9",key:2,fields:[{name:"ratio",type:"Percent",file:2},{name:"area",type:"Number",file:2},{name:"revenue",type:"Number",file:2}]}]})),x$.service("plUtil",["$rootScope"].concat(function(){var t;return t={format:{size:function(t){return 1e3>t?t+"bytes":1048576>t?parseInt(t/102.4)/10+"KB":parseInt(t/104857.6)/10+"MB"}}}})),x$.service("dataService",["$rootScope","sampleData","plUtil"].concat(function(t,e,a){var n,r;return n=function(t){return import$(this,t),this.size=a.format.size(angular.toJson(t.data).length),this.rows=t.data.length},n.prototype={id:0,name:null,owner:null,size:0,rows:0,type:{},fields:{},permission:{"switch":[],list:[]},save:function(){return this.id=r.save(this)},clone:function(){},"delete":function(){},update:function(){}},r={Dataset:n,datasets:[].concat(e),name:function(t){return"/datasets/"+t},local:{rows:0,size:0},init:function(){var t,e,a,n,r,i;this.local.rows=0,this.local.size=0;try{for(t=JSON.parse(localStorage.getItem("/list/datasets")||null)||[],e=0,a=t.length;a>e;++e)n=t[e],r=JSON.parse(localStorage.getItem(n)||null),r&&(this.local.rows+=r.rows,this.local.size+=r.size,this.datasets.push(r));return this.local.sizetext=this.verboseSize(this.local.size)}catch(o){return i=o,console.log(i.toString())}},find:function(){return null},genId:function(t){var e,a,n;for(e=0;1e3>e;++e)if(a=e,n="/dataset/"+t.type.name+"/"+Math.random().toString(36).substring(2),!this.find(n))return n;return null},save:function(t){var e,a;return t.id||"local"!==t.type.name||(t.id=this.genId(t)),t.id?(e=this.datasets.map(function(t){return t.id}).indexOf(t.id),e>=0&&this.datasets.splice(e,1),"local"===t.type.name&&(localStorage.setItem(t.id,angular.toJson(t)),a=JSON.parse(localStorage.getItem("/list/datasets")||null)||[],a.indexOf(t.id)<0&&a.push(t.id),localStorage.setItem("/list/datasets",angular.toJson(a))),this.datasets.push(t),t.id):console.log("failed to gen id")},"delete":function(t){var e,a;return e=this.datasets.map(function(t){return t.id}).indexOf(t.id),0>e||(this.datasets.splice(e,1),a=JSON.parse(localStorage.getItem("/list/datasets")),!a||(e=a.indexOf(t.id),0>e))?void 0:(a.splice(e,1),localStorage.setItem("/list/datasets",JSON.stringify(a)),localStorage.setItem(t.id,null))},verboseSize:function(){}},r.init(),r})),x$.controller("dataEditCtrl",["$scope","$timeout","$http","dataService","plUtil"].concat(function(t,e,a,n,r){return t.name=null,t.dataset=null,t.save=function(e){var a,r,i;return null==e&&(e=!1),a={name:t.name,type:{name:"local"},owner:null,permission:{"switch":["public"],list:[]},data:t.data.parsed,fields:function(){var e,a=[];for(r in e=t.data.parsed[0])i=e[r],a.push([r,i]);return a}().map(function(t){return{name:t[0],type:"String"}})},t.dataset=new n.Dataset(a),t.dataset.save()},t.data={init:function(){return t.$watch("data.raw",function(){return t.data.parse()})},raw:"",rows:0,size:0,parsed:null,parse:function(){var t=this;return this.handler&&e.cancel(this.handler),this.handler=e(function(){return t.handler=null,t.parsed=Papa.parse(t.raw,{header:!0}).data,t.rows=t.parsed.length,t.size=r.format.size(t.raw.length)},1e3)}},t.data.init(),t.parser={encoding:"UTF-8",csv:{toggle:function(){return setTimeout(function(){return $("#data-edit-csv-modal").modal("show")},0)},read:function(){var e,a;return e=$("#data-edit-csv-file")[0].files[0],a=new FileReader,a.onload=function(e){return t.$apply(function(){return t.data.raw=e.target.result.trim()}),$("#data-edit-csv-modal").modal("hide")},a.onerror=function(){},a.readAsText(e,t.parser.encoding)}},gsheet:{url:null,toggle:function(){return setTimeout(function(){return $("#data-edit-gsheet-modal").modal("show")},0)},read:function(){var e,n,r;return(e=/\/d\/([^\/]+)/.exec(t.parser.gsheet.url))?(n=e[1],r="https://spreadsheets.google.com/feeds/list/"+n+"/1/public/values?alt=json",a({url:r,method:"GET"}).success(function(e){var a,n,r,i;a={},e.feed.entry.map(function(t){var e,n,r=[];for(e in t)(n=/^gsx\$(.+)$/.exec(e))&&r.push(a[n[1]]=1);return r}),n=[];for(r in a)n.push(r);return a=n,i=[a.join(",")].concat(e.feed.entry.map(function(t){var e;return function(){var n,r,i,o=[];for(n=0,i=(r=a).length;i>n;++n)e=r[n],o.push((t["gsx$"+e]||{$t:""}).$t);return o}().join(",")})),t.data.raw=i.join("\n"),setTimeout(function(){return $("#data-edit-gsheet-modal").modal("hide")},0)})):void 0}},link:{url:null,toggle:function(){return setTimeout(function(){return $("#data-edit-link-modal").modal("show")},0)},read:function(){return a({url:"http://crossorigin.me/"+t.parser.link.url,method:"GET"}).success(function(e){return t.data.raw=e.trim(),$("#data-edit-link-modal").modal("hide")})}}}})),x$.controller("dataEditor",["$scope","$timeout","$http","dataService"].concat(function(){})),x$.controller("dataFiles",["$scope","dataService"].concat(function(t,e){return t.datasets=e.datasets,t.removedata=function(t){return e["delete"](t)}}));