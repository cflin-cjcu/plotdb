// Generated by LiveScript 1.3.1
plotdb.d3 = {};
plotdb.d3.axis = {
  overlap: function(axisGroup, axis, fontSize){
    var range, selection, minWidth, maxWidth, overlap;
    range = axis.scale().range();
    selection = axisGroup.selectAll(".tick text");
    if (!selection[0].length) {
      return;
    }
    minWidth = (range[1] - range[0]) / selection.length;
    maxWidth = d3.max(selection[0].map(function(d){
      return d.getBBox().width;
    }));
    overlap = maxWidth / minWidth;
    if (fontSize && overlap < 2) {
      selection.attr({
        transform: function(d, i){
          return ["translate(0,", overlap > 1 && i % 2 ? fontSize : 0, ")"].join(" ");
        }
      });
      return axisGroup.selectAll(".tick").style({
        opacity: 1
      });
    } else {
      selection.attr({
        transform: ""
      });
      return axisGroup.selectAll(".tick").style({
        opacity: function(d, i){
          if (i % parseInt(overlap + 1)) {
            return 0;
          } else {
            return 1;
          }
        }
      });
    }
  }
};
plotdb.d3.popup = function(root, sel, cb){
  var popup, x$;
  popup = root.querySelector('.pdb-popup');
  if (!popup) {
    popup = d3.select(root).append('div').attr({
      'class': 'pdb-popup float'
    });
    popup.each(function(d, i){
      var x$;
      x$ = d3.select(this);
      x$.append('div').attr({
        'class': 'title'
      });
      x$.append('div').attr({
        'class': 'value'
      });
      return x$;
    });
  } else {
    popup = d3.select(popup);
  }
  x$ = sel;
  x$.on('mousemove', function(d, i){
    var ref$, x, y, pbox, rbox;
    ref$ = [d3.event.clientX, d3.event.clientY], x = ref$[0], y = ref$[1];
    cb.call(this, d, i, popup);
    popup.style({
      display: 'block'
    });
    pbox = popup[0][0].getBoundingClientRect();
    rbox = root.getBoundingClientRect();
    x = x - pbox.width / 2;
    y = y + 20;
    if (y > rbox.top + rbox.height - pbox.height - 50) {
      y = y - pbox.height - 40;
    }
    if (x < 10) {
      x = 10;
    }
    if (x > rbox.left + rbox.width - pbox.width - 10) {
      x = rbox.left + rbox.width - pbox.width - 10;
    }
    return popup.style({
      top: y + "px",
      left: x + "px"
    });
  });
  x$.on('mouseout', function(){
    if (sel.hidePopup) {
      clearTimeout(sel.hidePopup);
    }
    return sel.hidePopup = setTimeout(function(){
      return popup.style({
        display: 'none'
      });
    }, 1000);
  });
  return x$;
};