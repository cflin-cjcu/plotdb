function import$(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}var x$;x$=angular.module("plotDB"),x$.filter("tags",function(){return function(t){return(t||"").split(",")}}),x$.filter("length",function(){return function(t){var e;return function(){var n=[];for(e in t)n.push(e);return n}().length}}),x$.service("chartService",["$rootScope","sampleChart","IOService","baseService"].concat(function(t,e,n,r){var i,o,c;return i={sample:[e]},o=function(){},o.prototype={name:"untitled",desc:null,tags:null,doc:{name:"document",type:"html",content:e.doc.content},style:{name:"stylesheet",type:"css",content:e.style.content},code:{name:"code",type:"javascript",content:e.code.content},config:{},dimension:{},assets:[],thumbnail:null,isType:!1,updateData:function(){function t(t){return"Number"===t.name}var e,n,r,i,o,c,a,u,s=[];for(this.data=[],e=Math.max.apply(null,function(){var t,e=[];for(n in t=this.dimension)r=t[n],e.push(r);return e}.call(this).reduce(function(t,e){return t.concat(e.fields||[])},[]).filter(function(t){return t.data}).map(function(t){return t.data.length}).concat([0])),i=0;e>i;++i){o=i,c={};for(n in a=this.dimension)r=a[n],c[n]=(u=(r.fields||(r.fields=[]))[0])?(u.data||(u.data=[]))[o]:null,r.type.filter(t).length&&(c[name]=parseFloat(c[name]));s.push(this.data.push(c))}return s}},c=r.derive("chart",i,o)})),x$.controller("chartEditor",["$scope","$http","$timeout","$interval","dataService","chartService","plNotify"].concat(function(t,e,n,r,i,o,c){return import$(t,{showsrc:!0,vis:"preview",lastvis:null,plotdomain:"http://localhost/",error:null,codemirror:{code:{lineWrapping:!0,lineNumbers:!0,mode:"javascript"},style:{lineWrapping:!0,lineNumbers:!0,mode:"css"},doc:{lineWrapping:!0,lineNumbers:!0,mode:"xml"},objs:[]},chart:new o.chart,canvas:{node:document.getElementById("chart-renderer"),window:document.getElementById("chart-renderer").contentWindow}}),import$(t,{save:function(t){return null==t&&(t=!1),t&&"chart"===this.chart.type.name&&(this.chart.type.name="charttype",this.chart.key=null),this.canvas.window.postMessage({type:"snapshot"},this.plotdomain)},load:function(t,e){var n=this;return o.load(t,e).then(function(t){return import$(n.chart,t)})},dimension:{bind:function(e,n,r){return null==r&&(r={}),r.update().then(function(){return n.fields=[r],t.render()})},unbind:function(t,e,n){var r;return null==n&&(n={}),r=e.fields.indexOf(n),0>r?void 0:e.fields.splice(r,1)}},reset:function(){return this.render()},render:function(t){var e,n,r,i;null==t&&(t=!0),this.chart.updateData();for(e in n=this.chart)r=n[e],"function"!=typeof r&&(this.chart[e]=r);return i=JSON.parse(angular.toJson(this.chart)),this.canvas.window.postMessage({type:"render",payload:i,rebind:t},this.plotdomain)},countline:function(){var t=this;return["code","style","doc"].map(function(e){return t.chart[e].lines=t.chart[e].content.split("\n").length,t.chart[e].size=t.chart[e].content.length})}}),import$(t,{sharePanel:{toggle:function(){return this.toggled=!this.toggled},toggled:!1,setPrivate:function(){return this.isPublic=!1},setPublic:function(){return this.isPublic=!0}},fullscreen:{toggle:function(){return this.toggled=!this.toggled},toggled:!1},coloredit:{config:function(t,e){return{"class":"no-palette",context:"context"+e,exclusive:!0,palette:[t.value]}}},paledit:{ldcp:null,item:null,init:function(){var e=this;return this.ldcp=new ldColorPicker(null,{},$("#palette-editor .editor .ldColorPicker")[0]),this.ldcp.on("change",function(){return setTimeout(function(){return t.$apply(function(){return e.update()})},0)})},update:function(){return this.item?this.item.value=this.ldcp.getPalette():void 0},toggled:!1,toggle:function(){return this.toggled=!this.toggled,this.toggled?void 0:this.update()},edit:function(t){return this.item=t,Array.isArray(t.value)&&(t.value={colors:t.value.map(function(t){return{hex:t}})}),this.ldcp.setPalette(t.value),this.toggled=!0}},hidHandler:function(){var e,n=this;return e=function(){return setTimeout(function(){return t.$apply(function(){var t;return t=n.vis,n.vis="preview"===n.vis&&n.lastvis?n.lastvis:"preview"===n.vis?"code":"preview",n.lastvis=t})},0)},t.codemirrored=function(e){return t.codemirror.objs.push(e)},document.body.addEventListener("keydown",function(n){return!n.metaKey&&!n.altKey||13!==n.keyCode&&13!==n.which?void 0:t.$apply(function(){return e()})})},checkParam:function(){var e,n,r,i,o;if(window.location.search&&(e=/[?&]k=([^&#|]+)\|([^&#|]+)\|([^&#|]+)/.exec(window.location.search)))return n=[e[1],e[2],e[3]],r=n[0],i=n[1],o=n[2],"charttype"!==i&&(i="chart"),t.load({name:i,location:r},o)},monitor:function(){var e=this;return this.$watch("vis",function(n){return setTimeout(function(){return e.codemirror.objs.map(function(e){var r,i,o;return r=function(){var e,n=[];for(i in e=t.codemirror)o=e[i],n.push([i,o]);return n}().filter(function(t){return t[1].mode===e.options.mode})[0],r&&!r[1].refreshed&&n.startsWith(r[0])?(e.refresh(),setTimeout(function(){return e.refresh()},0),r[1].refreshed=!0):void 0})},0)}),this.$watch("chart.doc.content",function(){return e.countline()}),this.$watch("chart.style.content",function(){return e.countline()}),this.$watch("chart.code.content",function(){return e.countline()}),this.$watch("chart.doc.content",function(){return e.render()}),this.$watch("chart.style.content",function(){return e.render()}),this.$watch("chart.code.content",function(t){return e.canvas.window.postMessage({type:"parse",payload:t},e.plotdomain)}),this.$watch("chart.config",function(){return e.render(!1)},!0)},communicate:function(){var e=this;return window.addEventListener("message",function(n){var r,i,o,a,u,s,l;if(r=n.data,r&&"object"==typeof r){if("error"===r.type)return t.$apply(function(){return t.error=r.payload});if("alt-enter"===r.type)return t.$apply(function(){return t.vis="code"});if("snapshot"===r.type)return e.chart.thumbnail=r.payload,e.chart.save().then(function(e){return c.send("success","chart saved"),t.$apply(function(){return import$(t.chart,e)})});if("parse"===r.type){i=JSON.parse(r.payload),o=i.config,a=i.dimension;for(u in i=e.chart.dimension)s=i[u],null!=a[u]&&(a[u].fields=s.fields);for(u in i=e.chart.config)s=i[u],null!=o[u]&&(o[u].value=s.value);for(u in o)s=o[u],null==s.value&&(s.value=s["default"]);return i=e.chart,i.config=o,i.dimension=a,t.render()}return"loaded"===r.type?e.canvas.window.postMessage({type:"parse",payload:e.chart.code.content},e.plotdomain):"click"===r.type?document.dispatchEvent?(l=document.createEvent("MouseEvents"),l.initEvent("click",!0,!0),l.synthetic=!0,document.dispatchEvent(l)):(l=document.createEventObject(),l.synthetic=!0,document.fireEvent("onclick",l)):void 0}},!1)},init:function(){return this.communicate(),this.hidHandler(),this.monitor(),this.checkParam(),this.paledit.init()}}),t.init()})),x$.controller("mychart",["$scope","$http","dataService","chartService"].concat(function(t,e,n,r){return r.list().then(function(e){return t.$apply(function(){return t.mycharts=e,t["goto"]=function(t){return window.location.href="/chart/?k="+t.type.location+"|"+t.type.name+"|"+t.key}})})})),x$.controller("chartList",["$scope","$http","dataService","chartService"].concat(function(t,e,n,r){return t.charttypes=[],r.list({name:"charttype",location:"any"}).then(function(e){return t.charttypes=e})}));