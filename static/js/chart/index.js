function import$(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}function in$(t,e){for(var n=-1,r=e.length>>>0;++n<r;)if(t===e[n])return!0;return!1}var x$;x$=angular.module("plotDB"),x$.filter("tags",function(){return function(t){return Array.isArray(t)?t:(t||"").split(",")}}),x$.filter("date",function(){return function(t){return new Date(t)}}),x$.filter("length",function(){return function(t){var e;return function(){var n=[];for(e in t)n.push(e);return n}().length}}),x$.service("chartService",["$rootScope","$http","sampleChart","IOService","baseService"].concat(function(t,e,n,r,a){var i,c,o;return i={sample:n,link:function(t){return"/chart/?k="+t.type.location.charAt(0)+t.key},thumblink:function(t){return this.sharelink(t)+"/thumb"},sharelink:function(t){return"http://localhost/v/chart/"+t.key}},c=function(t){return import$(this,{name:"untitled",owner:null,theme:null,parent:null,description:null,basetype:[],visualencoding:[],category:[],tags:[],likes:0,searchable:!1,doc:{name:"document",type:"html",content:i.sample[0].doc.content},style:{name:"stylesheet",type:"css",content:i.sample[0].style.content},code:{name:"code",type:"javascript",content:i.sample[0].code.content},assets:[],config:{},dimension:{}}),import$(this,t),this},c.prototype={like:function(t){var n=this;return new Promise(function(r,a){var i;return n.likes=(i=n.likes+(t?1:-1))>0?i:0,e({url:"/d/chart/"+n.key+"/like",method:"PUT"}).success(function(){return r()}).error(function(){var e;return n.likes=(e=n.likes-(t?1:-1))>0?e:0,a()})})},addFile:function(t,e,n){var r;return null==n&&(n=null),r={name:t,type:e,content:n},this.assets.push(r),r},removeFile:function(t){var e;return e=this.assets.indexOf(t),0>e?void 0:this.assets.splice(e,1)},updateData:function(){function t(t){return(t.data||(t.data=[]))[l]}function e(t){return t.name}function n(t){return"Number"===t.name}function r(t){return parseFloat(t)}var a,i,c,o,l,u,s,h,f=[];for(this.data=[],a=Math.max.apply(null,function(){var t,e=[];for(i in t=this.dimension)c=t[i],e.push(c);return e}.call(this).reduce(function(t,e){return t.concat(e.fields||[])},[]).filter(function(t){return t.data}).map(function(t){return t.data.length}).concat([0])),o=0;a>o;++o){l=o,u={};for(i in s=this.dimension)c=s[i],c.multiple?(u[i]=(c.fields||(c.fields=[])).length?(c.fields||(c.fields=[])).map(t):[],c.fieldName=(c.fields||(c.fields=[])).map(e)):(u[i]=(h=(c.fields||(c.fields=[]))[0])?(h.data||(h.data=[]))[l]:null,c.fieldName=(h=(c.fields||(c.fields=[]))[0])?h.name:null),c.type.filter(n).length&&(u[i]=Array.isArray(u[i])?u[i].map(r):parseFloat(u[i]));f.push(this.data.push(u))}return f}},o=a.derive("chart",i,c)})),x$.controller("mychart",["$scope","$http","dataService","chartService"].concat(function(t,e,n,r){return r.list().then(function(e){return t.$apply(function(){return t.charts=e,t["goto"]=function(t){return window.location.href=r.link(t)}})})})),x$.controller("chartList",["$scope","$http","IOService","dataService","chartService","plNotify"].concat(function(t,e,n,r,a,i){return t.q={type:null,enc:null,cat:null,dim:null,order:"Latest"},t.qmap={type:["Other","Bar Chart","Line Chart","Pie Chart","Area Chart","Bubble Chart","Radial Chart","Calendar","Treemap","Choropleth","Cartogram","Heatmap","Sankey","Venn Diagram","Word Cloud","Timeline","Mixed"],enc:["Other","Position","Position ( Non-aligned )","Length","Direction","Angle","Area","Volume","Curvature","Shade","Saturation"],cat:["Other","Infographics","Geographics","Interactive","Journalism","Statistics"],dim:[0,1,2,3,4,5,"> 5"]},t.$watch("q",function(){return t.fullcharts&&t.fullcharts.length||(t.fullcharts=t.charts),t.charts=t.fullcharts.filter(function(e){return!(t.q.type&&!in$(t.q.type,e.basetype||[])||t.q.enc&&!in$(t.q.enc,e.visualencoding||[])||t.q.cat&&!in$(t.q.cat,e.category||[])||t.q.dim&&e.dimlen!==t.q.dim&&!(99===t.q.dim&&e.dimlen.length>5))})},!0),t.like=function(e){var n,r,a,c;if(e)return n=(r=(a=t.user.data).likes||(a.likes={})).chart||(r.chart={}),c=n[e.key]=!n[e.key],e.like(c)["catch"](function(){return i.error("Can't do favorite. try again later?"),n[e.key]=!c})},t.charts=[],Promise.all([new Promise(function(t,e){return n.aux.listLocally({name:"chart"},t,e)}),new Promise(function(t,e){return n.aux.listRemotely({name:"chart"},t,e,"q=all")})]).then(function(e){return t.$apply(function(){var n,r,i,c,o,l,u,s,h,f,d=[];for(t.charts=e[0].concat(e[1]).map(function(t){return new a.chart(t)}),n=!1,r=0,i=t.charts.length;i>r;++r)c=r,o=t.charts[c],l=320,Math.random()>.6&&!n&&(l=Math.random()>.8?960:640,n=!0),c%3===2&&(n||(l=640),n=!1),o.width=l;if(window.location.search){u=d3.nest().key(function(t){return t[0]}).map(window.location.search.replace("?","").split("&").map(function(t){return t.split("=")}));for(s in h=t.q)f=h[s],u[s]&&d.push(t.q[s]=u[s][0][1]);return d}})})}));