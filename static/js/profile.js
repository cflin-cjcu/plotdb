var x$;x$=angular.module("plotDB"),x$.controller("profile",["$scope","$http","global","plNotify","dataService","chartService","themeService"].concat(function(e,n,r,a,t,s,i){return t.list().then(function(n){return e.$apply(function(){return e.datasets=n})}),i.list().then(function(n){return e.$apply(function(){return e.themes=n})}),e.profile=window.profileUser,e.passwd={oldOne:"",newOne:"",update:function(){return n({url:"/d/me/passwd/",method:"POST",data:{newpasswd:e.passwd.newOne,oldpasswd:e.passwd.oldOne}}).success(function(){return a.send("success","Password changed.")}).error(function(){return a.send("success","Password changing failed, try again later")})}},e.avatar={update:function(r){var t;if(0!==r.files.length)return/image\//.exec(r.files[0].type)?r.files[0].size>=1048576?void a.send("danger","File too large. try another instead. (<1MB) "):(a.send("warning","Uploading avatar..."),t=new FileReader,t.onload=function(){var r,t;return r=new Uint8Array(this.result),t=new FormData,t.append("image",new Blob([r],{type:"application/octet-stream"})),n({url:"/me/avatar",method:"POST",data:t,transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(n){return a.send("success","Avatar Changed."),e.profile.avatar=n.avatar}).error(function(){return a.send("danger","Image can't be used, use another image")})},t.readAsArrayBuffer(r.files[0])):void a.send("danger","Wrong file type, use image instead.")}},e.update=function(){return n({url:"/d/user/"+e.profile.key,method:"PUT",data:e.profile}).success(function(){return a.send("success","Profile updated.")}).error(function(e){return a.send("danger","Failed: "+e.msg)})}}));