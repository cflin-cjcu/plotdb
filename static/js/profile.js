var x$;x$=angular.module("plotDB"),x$.controller("profile",["$scope","$http","global","plNotify","dataService","chartService","themeService"].concat(function(e,t,n,r,a,s,i){return a.list().then(function(t){return e.$apply(function(){return e.datasets=t,d3.select("#dataset-number").transition().duration(1e3).tween("text",function(){return function(t){return this.textContent=parseInt(e.datasets.length*t)}})})}),i.list().then(function(t){return e.$apply(function(){return e.themes=t,d3.select("#theme-number").transition().duration(1e3).tween("text",function(){return function(t){return this.textContent=parseInt(e.themes.length*t)}})})}),s.list().then(function(t){return e.$apply(function(){return e.charts=t,d3.select("#chart-number").transition().duration(1e3).tween("text",function(){return function(t){return this.textContent=parseInt(e.charts.length*t)}})})}),e.profile=window.profileUser,e.passwd={oldOne:"",newOne:"",update:function(){return t({url:"/d/me/passwd/",method:"POST",data:{newpasswd:e.passwd.newOne,oldpasswd:e.passwd.oldOne}}).success(function(){return r.send("success","Password changed.")}).error(function(){return r.send("success","Password changing failed, try again later")})}},e.avatar={update:function(n){var a;if(0!==n.files.length)return/image\//.exec(n.files[0].type)?n.files[0].size>=1048576?void r.send("danger","File too large. try another instead. (<1MB) "):(r.send("warning","Uploading avatar..."),a=new FileReader,a.onload=function(){var n,a;return n=new Uint8Array(this.result),a=new FormData,a.append("image",new Blob([n],{type:"application/octet-stream"})),t({url:"/me/avatar",method:"POST",data:a,transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(t){return r.send("success","Avatar Changed."),e.profile.avatar=t.avatar}).error(function(){return r.send("danger","Image can't be used, use another image")})},a.readAsArrayBuffer(n.files[0])):void r.send("danger","Wrong file type, use image instead.")}},e.update=function(){return t({url:"/d/user/"+e.profile.key,method:"PUT",data:e.profile}).success(function(){return r.send("success","Profile updated.")}).error(function(e){return r.send("danger","Failed: "+e.msg)})}}));