function in$(e,t){for(var r=-1,n=t.length>>>0;++r<n;)if(e===t[r])return!0;return!1}function import$(e,t){var r={}.hasOwnProperty;for(var n in t)r.call(t,n)&&(e[n]=t[n]);return e}var x$;x$=angular.module("plotDB"),x$.service("IOService",["$rootScope","$http"].concat(function(e,t){var r,n;return r={localkey:function(){return(Math.random().toString(36)+"").substring(2)},saveLocally:function(e,t,r){var n,o,a,l;if(n=JSON.parse(localStorage.getItem("/db/list/"+e.type.name)),!e.key){for(o=0;10>o;++o)a=o,l=this.localkey(),in$(l,n);if(10===a)return r([!0,"generate local key failed"]);e.key=l}return e.key&&!in$(e.key,n)&&n.push(e.key),localStorage.setItem("/db/list/"+e.type.name,angular.toJson(n)),localStorage.setItem("/db/"+e.type.name+"/"+e.key,angular.toJson(e)),t(e)},saveRemotely:function(e,r,n){var o;return o=import$({data:e},e.key?{url:"/d/"+e.type.name+"/"+e.key,method:"PUT"}:{url:"/d/"+e.type.name,method:"POST"}),t(o).success(function(e){return r(e)}).error(function(e){return n([!0,e.toString()])})},loadLocally:function(e,t,r){var n;return n=JSON.parse(localStorage.getItem("/db/"+e.name+"/"+t)),r(n)},loadRemotely:function(e,r,n,o){var a;return a={url:"/d/"+e.name+"/"+r,method:"GET"},t(a).success(function(e){return n(e)}).error(function(e){return o([!0,e.toString()])})},listLocally:function(e,t){var r,n,o,a,l,c;for(r=JSON.parse(localStorage.getItem("/db/list/"+e.name+"/"))||[],n=[],o=0,a=r.length;a>o;++o)l=r[o],c=JSON.parse(localStorage.getItem("/db/"+e.name+"/"+l)),c&&n.push(c);return t(n)},listRemotely:function(e,r,n){return t({url:"/d/"+e.name,method:"GET"}).success(function(e){return r(e)}).error(function(e){return n([!0,e.toString()])})},verifyType:function(e){return e&&e.type&&"object"==typeof e.type&&e.type.name&&e.type.location?!1:!0}},n={save:function(e){return new Promise(function(t,n){return r.verifyType(e)?n([!0,"type incorrect"]):"local"===e.type.location?r.saveLocally(e,t,n):"server"===e.type.location?r.saveRemotely(e,t,n):n([!0,"not support type"])})},load:function(e,t){return new Promise(function(n,o){return r.verifyType({type:e})?o([!0,"type incorrect"]):"local"===e.location?r.loadLocally(e,t,n,o):"server"===e.location?r.loadRemotely(e,t,n,o):o([!0,"not support type"])})},list:function(e,t){return null==t&&(t={}),new Promise(function(t,n){return r.verifyType({type:e})?n([!0,"type incorrect"]):"local"===e.location?r.listLocally(e,t,n):"server"===e.location?r.listLocally(e,t,n):"any"===e.location?Promise.all([new Promise(function(t,n){return r.listLocally(e,t,n)}),new Promise(function(t,n){return r.listRemotely(e,t,n)})]).then(function(e){return t(e[0].concat(e[1]))}):n([!0,"not support type"])})}}}));