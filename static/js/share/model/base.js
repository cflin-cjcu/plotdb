function import$(e,n){var t={}.hasOwnProperty;for(var r in n)t.call(n,r)&&(e[r]=n[r]);return e}function in$(e,n){for(var t=-1,r=n.length>>>0;++t<r;)if(e===n[t])return!0;return!1}var model,ref$;ref$=function(e){var n,t,r,i,o;return this.config=e,this.name=(n=this.config).name,this.range=n.range,t=e.defaultFields,t===!0?(n=[model.type.user,model.type.id,model.type.permission],r=n[0],i=n[1],o=n[2]):"object"==typeof t&&(n={user:t.user,key:t.key,permission:t.permission},r=n.user,i=n.key,o=n.permission),r&&(((n=this.config).base||(n.base={})).owner={required:!0,type:model.type.key({type:r})}),i&&(((n=this.config).base||(n.base={})).key={required:!1,type:i}),o&&(this.config.base.permission={required:!0,type:o}),this},ref$.prototype={_validate:function(e,n,t){var r,i;if(n.required&&null==t)return[!0,e,"required"];if(null==t)return[!1];if(n.type&&(r=n.type.lint(t),!r||r[0]))return[!0,e,"type",r];if(n.max||n.min)if(n.type&&n.type.range){if(r=n.type.range({min:n.min,max:n.max},t),r[0])return r[1]=e,r}else{if(i=null!=t.length?t.length:t,n.max&&i>n.max)return[!0,e,"max"];if(n.min&&i<n.min)return[!0,e,"min"]}return[!1]},validate:function(e){function n(){var n,t,r=[];for(l in n=(t=this.config).base||(t.base={}))a=n[l],r.push([l,a,e[l]]);return r}var t,r,i,o,l,a,u,s;if((t=this.config.self)&&(r=this._validate(null,t,e),r[0]))return r;for(i=0,u=(o=[[null,this.config.self,e]].concat(n.call(this))).length;u>i;++i)if(s=o[i],s[1]&&(r=this._validate(s[0],s[1],s[2]),r[0]))return r;return[!1]},lint:function(e){var n;return n=this.validate(e),!n||n[0]?n:this.config.lint?this.config.lint(e):[!1,null,null]},clean:function(e){var n,t=this;return(n=this.config.clean)&&(e=n(e)),this["interface"]&&import$((e.getType=function(){return t},e),this["interface"]),e},create:function(){var e,n,t,r,i,o,l;e={};for(n in t=(r=this.config).base||(r.base={}))i=t[n],null!=i["default"]?e[n]=i["default"]:(o=((r=(l=i.type||(i.type={})).config||(l.config={})).self||(r.self={}))["default"])&&(e[n]=o);return e=(o=this.config.create)?o(e):e,this.clean(e)}},model=ref$,model.type=import$({},{"boolean":new model({name:"boolean",lint:function(e){return[!(!e||typeof e==typeof!0)]}}),string:new model({name:"string",lint:function(e){return[!("string"==typeof e||"number"==typeof e)]},range:function(e,n){var t,r,i;return t=e.min,r=e.max,i=(n+"").length,t>i?[!0,null,"min"]:i>r?[!0,null,"max"]:[!1]}}),email:new model({name:"email",lint:function(e){return[!(e&&"string"==typeof e&&/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]+/.exec(e))]}}),number:new model({name:"number",lint:function(e){return[!("number"==typeof e)]}}),date:new model({name:"date",lint:function(e){return"string"==typeof e&&!isNaN(new Date(e))&&e.length<50?[!1]:[isNaN(e)]}}),array:function(e){return new model({name:"array",type:e,lint:function(n){var t,r;return typeof n!=typeof[]||isNaN(parseInt(n.length))?[!0]:(t=function(){var t,i,o=[];for(t=0,i=n.length;i>t;++t)r=t,o.push([r,e.type.lint(n[r])]);return o}().filter(function(e){return e[1][0]})[0],t?[!0,t[0],t[1]]:[!1])}})},key:function(e){return new model({name:"key",type:e,lint:function(e){return typeof e==typeof{}||"string"==typeof e||"number"==typeof e?[!1]:[!0,null,"type"]}})},keys:function(e){return new model({name:"keys",type:e,lint:function(e){var n,t;return typeof e!=typeof[]||isNaN(parseInt(e.length))?[!0]:(n=function(){var n,r,i=[];for(n=0,r=e.length;r>n;++n)t=n,i.push([t,e[t]]);return i}().filter(function(e){return!e[1]})[0],n?[!0,n[0],n[1]]:[!1])}})},id:new model({name:"id",lint:function(){return[!1]}})}),import$(model.type,{permission:new model({name:"permission",switches:["private","public","list","token"],permtype:["read","fork","write","admin"],lint:function(e){var n,t,r,i;if(!e)return[!0,null,"ISNULL"];if("object"!=typeof e)return[!0,null,"NOTOBJ"];if(null==e["switch"]||!Array.isArray(e["switch"]))return[!0,null,"switch"];if(null==e.value||!Array.isArray(e.value))return[!0,null,"value"];for(n=0,r=(t=e["switch"]).length;r>n;++n)if(i=t[n],!in$(i,model.type.permission.config.switches))return[!0,i["switch"],"switch"];for(n=0,r=(t=e.value).length;r>n;++n){if(i=t[n],"object"!=typeof i)return[!0,i,"value"];if(!in$(i["switch"],model.type.permission.config.switches))return[!0,i["switch"],"switch"];if(!in$(i.perm,model.type.permission.config.permtype))return[!0,i.perm,"permtype"]}return[!1]}}),user:new model({name:"user",base:{username:{required:!0,type:model.type.email},password:{type:model.type.string},usepasswd:{type:model.type["boolean"]},displayname:{max:30,min:3,required:!0,type:model.type.string},description:{max:1e3,type:model.type.string},createdtime:{type:model.type.date},public_email:{type:model.type["boolean"]},avatar:{max:300,type:model.type.string}}})}),module.exports=model;