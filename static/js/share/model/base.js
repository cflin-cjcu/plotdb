function import$(e,t){var n={}.hasOwnProperty;for(var r in t)n.call(t,r)&&(e[r]=t[r]);return e}function in$(e,t){for(var n=-1,r=t.length>>>0;++n<r;)if(e===t[n])return!0;return!1}var model,ref$;ref$=function(e){var t,n,r,i,o;return this.config=e,this.name=(t=this.config).name,this.range=t.range,n=e.defaultFields,n===!0?(t=[model.type.user,model.type.id,model.type.permission],r=t[0],i=t[1],o=t[2]):"object"==typeof n&&(t={user:n.user,key:n.key,permission:n.permission},r=t.user,i=t.key,o=t.permission),r&&(((t=this.config).base||(t.base={})).owner={required:!0,type:model.type.key({type:r})}),i&&(((t=this.config).base||(t.base={})).key={required:!1,type:i}),o&&(this.config.base.permission={required:!0,type:o}),this},ref$.prototype={_validate:function(e,t,n){var r,i;if(t.required&&null==n)return[!0,e,"required"];if(null==n)return[!1];if(t.type&&(r=t.type.lint(n),!r||r[0]))return[!0,e,"type",r];if(t.max||t.min)if(t.type&&t.type.range){if(r=t.type.range({min:t.min,max:t.max},n),r[0])return r[1]=e,r}else{if(i=null!=n.length?n.length:n,t.max&&i>t.max)return[!0,e,"max"];if(t.min&&i<t.min)return[!0,e,"min"]}return[!1]},validate:function(e){function t(){var t,n,r=[];for(l in t=(n=this.config).base||(n.base={}))u=t[l],r.push([l,u,e[l]]);return r}var n,r,i,o,l,u,a,s;if((n=this.config.self)&&(r=this._validate(null,n,e),r[0]))return r;for(i=0,a=(o=[[null,this.config.self,e]].concat(t.call(this))).length;a>i;++i)if(s=o[i],s[1]&&(r=this._validate(s[0],s[1],s[2]),r[0]))return r;return[!1]},lint:function(e){var t;return t=this.validate(e),!t||t[0]?t:this.config.lint?this.config.lint(e):[!1,null,null]},clean:function(e){var t,n=this;return(t=this.config.clean)&&(e=t(e)),this["interface"]&&import$((e.getType=function(){return n},e),this["interface"]),e},create:function(){var e,t,n,r,i,o,l;e={};for(t in n=(r=this.config).base||(r.base={}))i=n[t],null!=i["default"]?e[t]=i["default"]:(o=((r=(l=i.type||(i.type={})).config||(l.config={})).self||(r.self={}))["default"])&&(e[t]=o);return e=(o=this.config.create)?o(e):e,this.clean(e)}},model=ref$,model.type=import$({},{"boolean":new model({lint:function(e){return[!(!e||typeof e==typeof!0)]}}),string:new model({lint:function(e){return[!("string"==typeof e||"number"==typeof e)]},range:function(e,t){var n,r,i;return n=e.min,r=e.max,i=(t+"").length,n>i?[!0,null,"min"]:i>r?[!0,null,"max"]:[!1]}}),email:new model({lint:function(e){return[!(e&&"string"==typeof e&&/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]+/.exec(e))]}}),number:new model({lint:function(e){return[!("number"==typeof e)]}}),date:new model({lint:function(e){return"string"==typeof e&&!isNaN(new Date(e))&&e.length<50?[!1]:[isNaN(e)]}}),array:function(e){return new model({lint:function(t){var n,r;return typeof t!=typeof[]||isNaN(parseInt(t.length))?[!0]:(n=function(){var n,i,o=[];for(n=0,i=t.length;i>n;++n)r=n,o.push([r,e.type.lint(t[r])]);return o}().filter(function(e){return e[1][0]})[0],n?[!0,n[0],n[1]]:[!1])}})},key:function(){return new model({lint:function(e){return typeof e==typeof{}||"string"==typeof e||"number"==typeof e?[!1]:[!0,null,"type"]}})},keys:function(){return new model({lint:function(e){var t,n;return typeof e!=typeof[]||isNaN(parseInt(e.length))?[!0]:(t=function(){var t,r,i=[];for(t=0,r=e.length;r>t;++t)n=t,i.push([n,e[n]]);return i}().filter(function(e){return!e[1]})[0],t?[!0,t[0],t[1]]:[!1])}})},id:new model({lint:function(){return[!1]}})}),import$(model.type,{permission:new model({name:"permission",switches:["private","public","list","token"],permtype:["read","fork","write","admin"],lint:function(e){var t,n,r,i;if(!e)return[!0,null,"ISNULL"];if("object"!=typeof e)return[!0,null,"NOTOBJ"];if(null==e["switch"]||!Array.isArray(e["switch"]))return[!0,null,"switch"];if(null==e.value||!Array.isArray(e.value))return[!0,null,"value"];for(t=0,r=(n=e["switch"]).length;r>t;++t)if(i=n[t],!in$(i,model.type.permission.config.switches))return[!0,i["switch"],"switch"];for(t=0,r=(n=e.value).length;r>t;++t){if(i=n[t],"object"!=typeof i)return[!0,i,"value"];if(!in$(i["switch"],model.type.permission.config.switches))return[!0,i["switch"],"switch"];if(!in$(i.perm,model.type.permission.config.permtype))return[!0,i.perm,"permtype"]}return[!1]}}),user:new model({name:"user",base:{username:{required:!0,type:model.type.email},password:{type:model.type.string},usepasswd:{type:model.type["boolean"]},displayname:{max:30,min:3,required:!0,type:model.type.string},description:{max:1e3,type:model.type.string},createdtime:{type:model.type.date},public_email:{type:model.type["boolean"]},avatar:{max:300,type:model.type.string}}})}),module.exports=model;